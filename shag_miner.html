<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>1SHAG –µ–∫–æ –º–∞–π–Ω–µ—Ä</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="assets/1shag/1SHAG_logo_512.png" />

  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

  <style>
    * { box-sizing: border-box; font-family: system-ui, -apple-system, sans-serif; }
    body { margin: 0; min-height: 100vh; display: flex; align-items: center; justify-content: center; background: radial-gradient(circle at top, #26263a 0, #050509 45%, #000000 100%); color: #f5f5f5; }
    .wrapper { width: 100%; max-width: 520px; padding: 16px; }
    .card { width: 100%; background: radial-gradient(circle at top, #181825 0, #070710 55%, #030307 100%); border-radius: 22px; padding: 20px 18px 18px; box-shadow: 0 18px 45px rgba(0, 0, 0, 0.9); border: 1px solid rgba(255, 215, 0, 0.22); position: relative; overflow: hidden; }
    .bg-rack { position: absolute; inset: 0; pointer-events: none; opacity: 0.06; background-image: linear-gradient(90deg, rgba(255, 255, 255, 0.18) 1px, transparent 1px), linear-gradient(180deg, rgba(255, 255, 255, 0.08) 1px, transparent 1px); background-size: 46px 46px; }
    .header { display: flex; align-items: center; justify-content: space-between; position: relative; z-index: 1; margin-bottom: 12px; }
    .title-block { display: flex; flex-direction: column; gap: 2px; }
    .title { font-size: 18px; font-weight: 700; }
    .subtitle { font-size: 12px; color: #c6c6d8; }
    .wallet-btn { border-radius: 999px; padding: 6px 10px; font-size: 12px; border: 1px solid #3b3b5a; background: #12121c; color: #f5f5f5; display: inline-flex; align-items: center; gap: 6px; cursor: pointer; }
    .wallet-dot { width: 8px; height: 8px; border-radius: 50%; background: #ff8080; }
    .wallet-dot.ok { background: #9be38b; }
    .wallet-dot.warn { background: #f5d26c; }
    .center { position: relative; z-index: 1; display: flex; flex-direction: column; align-items: center; gap: 10px; margin-top: 4px; }
    .coin-image-wrapper { width: 110px; height: 110px; border-radius: 50%; padding: 4px; background: radial-gradient(circle at 30% 20%, #e4f6ff 0%, #bfe3ff 30%, #7dc2ff 65%, #2468b2 100%); box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.9), 0 4px 14px rgba(0, 0, 0, 0.9), 0 0 26px rgba(255, 215, 0, 0.8); display: flex; align-items: center; justify-content: center; animation: coin-sway 8s ease-in-out infinite; }
    .coin-image { width: 100%; height: 100%; object-fit: contain; border-radius: 50%; }
    @keyframes coin-sway { 0%, 100% { transform: rotateY(0deg); } 50% { transform: rotateY(4deg); } }
    .farm { width: 100%; max-width: 380px; margin-top: 4px; display: flex; flex-direction: column; gap: 6px; }
    .rig-row { display: flex; gap: 6px; justify-content: center; }
    .rig { flex: 1; min-width: 0; background: linear-gradient(145deg, #101020, #05050b); border-radius: 11px; border: 1px solid rgba(120, 130, 180, 0.6); padding: 4px 6px 5px; box-shadow: 0 3px 8px rgba(0, 0, 0, 0.7), inset 0 0 10px rgba(0, 0, 0, 0.75); }
    .rig-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
    .rig-name { font-size: 9px; color: #a6a9d0; letter-spacing: 0.14em; }
    .rig-leds { display: flex; gap: 3px; }
    .rig-led { width: 7px; height: 7px; border-radius: 50%; background: #333548; }
    .rig-led--green { background: #68ff9a; box-shadow: 0 0 6px #68ff9a; animation: ledPulseGreen 2.4s infinite; }
    @keyframes ledPulseGreen { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }
    .rig-body { display: flex; justify-content: space-between; align-items: center; }
    .fan { width: 20px; height: 20px; border-radius: 50%; border: 2px solid #3e435f; position: relative; animation: fanSpin 1.8s linear infinite; }
    .fan-blade { position: absolute; width: 55%; height: 2px; background: #a9b4ff; top: 48%; left: 22%; transform-origin: 50% 50%; }
    .fan-blade:nth-child(2) { transform: rotate(90deg); }
    .fan-blade:nth-child(3) { transform: rotate(180deg); }
    .fan-blade:nth-child(4) { transform: rotate(270deg); }
    @keyframes fanSpin { 100% { transform: rotate(360deg); } }
    .rig-temp { font-size: 9px; color: #a6a9d0; text-align: right; }
    .rig-temp span { color: #ffb26a; }
    .counter { width: 100%; background: #0d0d18; border-radius: 12px; border: 1px solid #343454; padding: 8px 10px; text-align: center; box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.85); }
    .counter-value { font-size: 22px; font-weight: 700; color: #ffe9a3; font-family: "Courier New", monospace; }
    .progress-bar { width: 100%; height: 8px; border-radius: 999px; background: #181826; border: 1px solid #343454; overflow: hidden; margin-top: 10px; }
    .progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #f1c550, #b8741a); box-shadow: 0 0 10px rgba(255, 215, 0, 0.8); transition: width 0.25s ease-out; }
    .status { font-size: 12px; margin-top: 6px; text-align: center; }
    .status-ok { color: #9be38b; }
    .status-warn { color: #f5d26c; }
    .claim-btn { margin-top: 14px; width: 100%; padding: 12px; border-radius: 999px; border: none; font-size: 15px; font-weight: 700; cursor: pointer; background: linear-gradient(135deg, #f1c550, #b8741a); color: #231407; box-shadow: 0 10px 20px rgba(0,0,0,0.7), 0 0 12px rgba(255, 215, 0, 0.8); }
    .claim-btn:disabled { opacity: 0.6; cursor: default; box-shadow: none; }
    
    /* –î–æ–¥–∞—Ç–∫–æ–≤—ñ –∫–Ω–æ–ø–∫–∏ */
    .extra-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; width: 100%; }
    .action-btn { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 10px; color: #ccc; font-size: 11px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; }
    .action-btn:hover { background: rgba(255, 255, 255, 0.1); border-color: #f1c550; color: #fff; }
  </style>
</head>

<body>
<div class="wrapper">
  <div class="card">
    <div class="bg-rack"></div>

    <div class="header">
      <div class="title-block">
        <div class="title">1SHAG —Å—É–ø–µ—Ä-–µ–∫–æ –º–∞–π–Ω–µ—Ä</div>
        <div class="subtitle">–û—Ñ—ñ—Ü—ñ–π–Ω–∏–π Faucet 1SHAG / 24 –≥–æ–¥.</div>
      </div>
      <button id="connectBtn" class="wallet-btn">
        <span class="wallet-dot" id="walletDot"></span>
        <span id="walletLabel">–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ –≥–∞–º–∞–Ω–µ—Ü—å</span>
      </button>
    </div>

    <div class="center">
      <div class="coin-image-wrapper">
        <img src="assets/1shag/1SHAG_logo_512.png" alt="SHAG" class="coin-image" />
      </div>

      <div class="farm">
        <div class="rig-row">
          <div class="rig">
            <div class="rig-header"><div class="rig-name">RIG-01</div><div class="rig-leds"><div class="rig-led rig-led--green"></div></div></div>
            <div class="rig-body">
              <div class="fan"><div class="fan-blade"></div><div class="fan-blade"></div><div class="fan-blade"></div><div class="fan-blade"></div></div>
              <div class="rig-temp">–¢–µ–º–ø:<br><span>100 SHAG</span></div>
            </div>
          </div>
          <div class="rig">
            <div class="rig-header"><div class="rig-name">RIG-02</div><div class="rig-leds"><div class="rig-led rig-led--green"></div></div></div>
            <div class="rig-body">
              <div class="fan"><div class="fan-blade"></div><div class="fan-blade"></div><div class="fan-blade"></div><div class="fan-blade"></div></div>
              <div class="rig-temp">–°—Ç–∞—Ç—É—Å:<br><span>Online</span></div>
            </div>
          </div>
        </div>
      </div>

      <div style="width: 100%; max-width: 380px;">
        <div class="counter">
          <span id="counterValue" class="counter-value">0.00000000</span> <small style="color:#d7cfa9">SHAG</small>
        </div>
        <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
        <div id="statusText" class="status status-warn">–ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –≥–∞–º–∞–Ω–µ—Ü—å —É –º–µ—Ä–µ–∂—ñ BSC</div>

        <button id="claimBtn" class="claim-btn" disabled>–û–¢–†–ò–ú–ê–¢–ò 100 SHAG</button>

        <div class="extra-btns">
          <button class="action-btn" onclick="addToken()">
            <img src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" width="16"> + SHAG
          </button>
          <button class="action-btn" onclick="window.open('https://link.metamask.io/rewards?referral=PWEPD8', '_blank')">
            üîó –†–µ—Ñ–µ—Ä–∞–ª–∫–∞
          </button>
        </div>

        <div id="timerText" style="text-align:center; font-size:11px; margin-top:10px; color:#9f9fc0;">–î–æ –≤–∏–ø–ª–∞—Ç–∏: 24:00:00</div>
        <div class="info" style="font-size:11px; text-align:center; color:#7f8094; margin-top:10px;">
          <div id="faucetInfo">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤...</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const TOKEN_ADDRESS = "0xd4c35feccf968f4a73be4717524c087d7d0ed229";
  const FAUCET_ADDRESS = "0xea4b64d8eecbe54ba18444c6522a7f19f7ca152e";
  const TOKEN_DECIMALS = 18;

  const FAUCET_ABI = [
    "function rewardAmount() view returns (uint256)",
    "function claimInterval() view returns (uint256)",
    "function lastClaimTime(address) view returns (uint256)",
    "function faucetBalance() view returns (uint256)",
    "function canClaim(address) view returns (bool)",
    "function claim()",
    "function isPaused() view returns (bool)"
  ];

  let provider, signer, userAddress, faucetContract, rewardAmountBN, claimIntervalSec = 86400, lastClaimTimeSec = 0;

  function trimTo8Decimals(str) {
    if (!str.includes(".")) return str + ".00000000";
    const [whole, frac] = str.split(".");
    return whole + "." + (frac + "00000000").slice(0, 8);
  }

  async function addToken() {
    if (!window.ethereum) return alert("MetaMask –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ");
    try {
      await window.ethereum.request({
        method: 'wallet_watchAsset',
        params: {
          type: 'ERC20',
          options: {
            address: TOKEN_ADDRESS,
            symbol: '1SHAG',
            decimals: TOKEN_DECIMALS,
            image: window.location.origin + '/assets/1shag/1SHAG_logo_512.png',
          },
        },
      });
    } catch (e) { console.error(e); }
  }

  async function connect() {
    if (!window.ethereum) return;
    provider = new ethers.providers.Web3Provider(window.ethereum);
    const accounts = await provider.send("eth_requestAccounts", []);
    userAddress = accounts[0];
    signer = provider.getSigner();
    
    document.getElementById("walletLabel").innerText = userAddress.slice(0,6)+"..."+userAddress.slice(-4);
    document.getElementById("walletDot").classList.add("ok");
    
    faucetContract = new ethers.Contract(FAUCET_ADDRESS, FAUCET_ABI, signer);
    await loadFaucetParams();
    refresh();
    setInterval(refresh, 1000);
  }

  async function loadFaucetParams() {
    try {
      rewardAmountBN = await faucetContract.rewardAmount();
      claimIntervalSec = (await faucetContract.claimInterval()).toNumber();
      const faucetBalanceBN = await faucetContract.faucetBalance();
      
      const rewardHuman = ethers.utils.formatUnits(rewardAmountBN, TOKEN_DECIMALS);
      const balanceHuman = ethers.utils.formatUnits(faucetBalanceBN, TOKEN_DECIMALS);
      
      document.getElementById("faucetInfo").textContent = `–í–∏–Ω–∞–≥–æ—Ä–æ–¥–∞: ${trimTo8Decimals(rewardHuman)} SHAG. –ë–∞–ª–∞–Ω—Å Faucet: ${trimTo8Decimals(balanceHuman)} SHAG.`;
    } catch (e) { console.error(e); }
  }

  async function refresh() {
    if (!userAddress) return;
    try {
      const last = await faucetContract.lastClaimTime(userAddress);
      lastClaimTimeSec = last.toNumber();
      const now = Math.floor(Date.now() / 1000);
      let elapsed = lastClaimTimeSec === 0 ? claimIntervalSec : now - lastClaimTimeSec;
      if (elapsed < 0) elapsed = 0;
      
      const progress = Math.min(1, elapsed / claimIntervalSec);
      if (rewardAmountBN) {
        const scale = ethers.BigNumber.from(Math.floor(progress * 1000000));
        const earned = rewardAmountBN.mul(scale).div(1000000);
        document.getElementById("counterValue").innerText = trimTo8Decimals(ethers.utils.formatUnits(earned, 18));
      }

      document.getElementById("progressFill").style.width = (progress * 100) + "%";
      const remaining = Math.max(0, claimIntervalSec - elapsed);
      const h = String(Math.floor(remaining/3600)).padStart(2, '0');
      const m = String(Math.floor((remaining%3600)/60)).padStart(2, '0');
      const s = String(remaining%60).padStart(2, '0');
      document.getElementById("timerText").innerText = `–î–æ –≤–∏–ø–ª–∞—Ç–∏: ${h}:${m}:${s}`;

      const canClaim = await faucetContract.canClaim(userAddress);
      if (canClaim) {
        document.getElementById("claimBtn").disabled = false;
        document.getElementById("statusText").innerText = "–ì–æ—Ç–æ–≤—ñ –¥–æ –≤–∏–≤–æ–¥—É!";
        document.getElementById("statusText").className = "status status-ok";
      } else {
        document.getElementById("claimBtn").disabled = true;
        document.getElementById("statusText").innerText = "–ú–∞–π–Ω—ñ–Ω–≥ —Ç–æ–∫–µ–Ω—ñ–≤...";
        document.getElementById("statusText").className = "status status-warn";
      }
    } catch(e) {}
  }

  document.getElementById("connectBtn").addEventListener("click", connect);
  document.getElementById("claimBtn").addEventListener("click", async () => {
    try {
      const tx = await faucetContract.claim();
      await tx.wait();
      alert("–û—Ç—Ä–∏–º–∞–Ω–æ!");
      loadFaucetParams();
    } catch(e) { alert("–ü–æ–º–∏–ª–∫–∞!"); }
  });
</script>
</body>
</html>
