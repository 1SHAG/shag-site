<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>1SHAG —Å—É–ø–µ—Ä-–µ–∫–æ –º–∞–π–Ω–µ—Ä</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/1SHAG/shag-site/main/assets/1shag/1SHAG_logo_512.png" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

  <style>
    * {
      box-sizing: border-box;
      font-family: 'Montserrat', system-ui, -apple-system, sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #1b2940 0, #050816 45%, #000000 100%);
      color: #f5f5f5;
    }

    .wrapper { width: 100%; max-width: 520px; padding: 16px; }

    .card {
      width: 100%;
      background: radial-gradient(circle at top, #181825 0, #070710 55%, #030307 100%);
      border-radius: 24px;
      padding: 24px;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(255, 213, 74, 0.2);
      position: relative;
      overflow: hidden;
    }

    .bg-rack {
      position: absolute; inset: 0; pointer-events: none; opacity: 0.05;
      background-image: linear-gradient(90deg, #fff 1px, transparent 1px), linear-gradient(180deg, #fff 1px, transparent 1px);
      background-size: 40px 40px;
    }

    .header { display: flex; justify-content: space-between; align-items: flex-start; z-index: 1; position: relative; margin-bottom: 20px; }
    .title { font-size: 18px; font-weight: 700; color: #fff; }
    .subtitle { font-size: 11px; color: #a9b0c2; margin-top: 4px; }

    .wallet-btn {
      border-radius: 12px; padding: 8px 12px; font-size: 12px; font-weight: 600;
      border: 1px solid #343454; background: #0d0d18; color: #fff; cursor: pointer;
      display: flex; align-items: center; gap: 8px; transition: 0.2s;
    }
    .wallet-btn:hover { border-color: #ffd54a; background: #161625; }
    .wallet-dot { width: 8px; height: 8px; border-radius: 50%; background: #ff5252; }
    .wallet-dot.ok { background: #4caf50; box-shadow: 0 0 8px #4caf50; }

    .coin-image-wrapper {
      width: 100px; height: 100px; border-radius: 50%; margin: 10px auto;
      background: radial-gradient(circle, #ffd54a 0%, #ffb300 100%);
      box-shadow: 0 0 30px rgba(255, 213, 74, 0.4);
      padding: 5px; animation: sway 4s ease-in-out infinite;
    }
    @keyframes sway { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

    .farm { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; margin: 20px 0; }
    .rig { 
        background: #0d0d18; border: 1px solid rgba(255,255,255,0.05); 
        border-radius: 12px; padding: 10px; position: relative;
    }
    .fan { 
        width: 24px; height: 24px; border: 2px solid #343454; border-radius: 50%; 
        animation: spin 1s linear infinite; display: inline-block;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }

    .counter {
      background: #000; border-radius: 12px; padding: 15px; text-align: center;
      border: 1px solid #343454; margin: 15px 0;
    }
    .counter-value { font-size: 28px; font-family: monospace; color: #ffd54a; font-weight: bold; }

    .progress-bar { height: 10px; background: #1a1a2e; border-radius: 5px; overflow: hidden; margin: 10px 0; border: 1px solid #343454; }
    .progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #ffd54a, #ffb300); transition: width 0.5s ease; }

    .claim-btn {
      width: 100%; padding: 15px; border-radius: 14px; border: none;
      background: linear-gradient(135deg, #ffd54a, #ffb300);
      color: #000; font-weight: 700; cursor: pointer; font-size: 16px;
      transition: 0.2s; box-shadow: 0 5px 15px rgba(255, 211, 74, 0.3);
    }
    .claim-btn:disabled { opacity: 0.5; cursor: not-allowed; box-shadow: none; }
    .claim-btn:hover:not(:disabled) { transform: scale(1.02); }

    .status { font-size: 12px; text-align: center; margin-top: 10px; min-height: 18px; }
    .status-ok { color: #4caf50; } .status-warn { color: #ffd54a; } .status-error { color: #ff5252; }

    /* –ù–æ–≤—ñ —Å—Ç–∏–ª—ñ –¥–ª—è –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –∫–Ω–æ–ø–æ–∫ */
    .extra-btns {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 20px;
    }
    .secondary-btn {
      background: #12121c;
      border: 1px solid #343454;
      color: #a9b0c2;
      padding: 10px;
      border-radius: 10px;
      font-size: 9px;
      font-weight: 700;
      text-decoration: none;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: 0.2s;
      cursor: pointer;
    }
    .secondary-btn:hover {
      border-color: #ffd54a;
      color: #fff;
      background: #161625;
    }
    .rewards-btn {
      background: linear-gradient(135deg, #424261, #24243e);
      border-color: #5d5d81;
      color: #e0e0e0;
    }
  </style>
</head>

<body>
<div class="wrapper">
  <div class="card">
    <div class="bg-rack"></div>

    <div class="header">
      <div class="title-block">
        <div class="title">1SHAG Eco Miner</div>
        <div class="subtitle">Faucet: 100 SHAG / 24 –≥–æ–¥.</div>
      </div>
      <button id="connectBtn" class="wallet-btn">
        <span class="wallet-dot" id="walletDot"></span>
        <span id="walletLabel">–£–≤—ñ–π—Ç–∏</span>
      </button>
    </div>

    <div class="coin-image-wrapper">
      <img src="https://raw.githubusercontent.com/1SHAG/shag-site/main/assets/1shag/1SHAG_logo_512.png" style="width:100%; border-radius:50%">
    </div>

    <div class="farm">
      <div class="rig">
        <div style="font-size:9px; color:#a9b0c2">RIG-01 STATUS</div>
        <div style="display:flex; align-items:center; gap:5px; margin-top:5px;">
            <div class="fan"></div> <span style="font-size:10px; color:#4caf50">Active</span>
        </div>
      </div>
      <div class="rig">
        <div style="font-size:9px; color:#a9b0c2">NETWORK</div>
        <div style="font-size:11px; margin-top:5px; color:#ffd54a">BNB Smart Chain</div>
      </div>
    </div>

    <div class="counter">
      <div id="counterValue" class="counter-value">0.00000000</div>
      <div style="font-size:10px; color:#a9b0c2; margin-top:5px;">–ù–∞–∫–æ–ø–∏—á–µ–Ω–æ SHAG</div>
    </div>

    <div class="progress-bar">
      <div id="progressFill" class="progress-fill"></div>
    </div>

    <div id="statusText" class="status status-warn">–ë—É–¥—å –ª–∞—Å–∫–∞, –ø—ñ–¥–∫–ª—é—á—ñ—Ç—å –≥–∞–º–∞–Ω–µ—Ü—å</div>

    <button id="claimBtn" class="claim-btn" disabled>–û–¢–†–ò–ú–ê–¢–ò 100 SHAG</button>
    
    <div id="timerText" style="text-align:center; font-size:11px; color:#a9b0c2; margin-top:10px;">
        –¢–∞–π–º–µ—Ä: 24:00:00
    </div>

    <div class="extra-btns">
        <div class="secondary-btn" onclick="addToken()">
            + –î–û–î–ê–¢–ò SHAG –í METAMASK
        </div>
        <a href="https://link.metamask.io/rewards?referral=PWEPD8" target="_blank" class="secondary-btn rewards-btn">
            METAMASK REWARDS üéÅ
        </a>
    </div>

  </div>
</div>

<script>
  const TOKEN_ADDRESS = "0xd4c35feccf968f4a73be4717524c087d7d0ed229";
  const FAUCET_ADDRESS = "0xea4b64d8eecbe54ba18444c6522a7f19f7ca152e";
  const BSC_CHAIN_ID = "0x38"; // 56 –≤ hex

  const FAUCET_ABI = [
    "function rewardAmount() view returns (uint256)",
    "function claimInterval() view returns (uint256)",
    "function isPaused() view returns (bool)",
    "function lastClaimTime(address) view returns (uint256)",
    "function faucetBalance() view returns (uint256)",
    "function canClaim(address) view returns (bool)",
    "function claim()"
  ];

  let provider, signer, userAddress, faucetContract;
  let rewardAmountBN, claimIntervalSec, lastClaimTimeSec = 0;

  async function checkNetwork() {
    const { chainId } = await provider.getNetwork();
    if (chainId !== 56) {
      try {
        await window.ethereum.request({
          method: 'wallet_switchEthereumChain',
          params: [{ chainId: BSC_CHAIN_ID }],
        });
      } catch (err) {
        if (err.code === 4902) {
            alert("–î–æ–¥–∞–π—Ç–µ –º–µ—Ä–µ–∂—É BSC —É –≤–∞—à –≥–∞–º–∞–Ω–µ—Ü—å");
        }
      }
      return false;
    }
    return true;
  }

  async function connect() {
    if (!window.ethereum) return alert("–í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å MetaMask");
    provider = new ethers.providers.Web3Provider(window.ethereum);
    
    if (!(await checkNetwork())) return;

    const accounts = await provider.send("eth_requestAccounts", []);
    userAddress = accounts[0];
    signer = provider.getSigner();
    
    document.getElementById("walletLabel").innerText = userAddress.slice(0,6)+"..."+userAddress.slice(-4);
    document.getElementById("walletDot").classList.add("ok");

    faucetContract = new ethers.Contract(FAUCET_ADDRESS, FAUCET_ABI, signer);
    
    loadData();
    setInterval(updateUI, 1000);
  }

  async function loadData() {
    rewardAmountBN = await faucetContract.rewardAmount();
    claimIntervalSec = (await faucetContract.claimInterval()).toNumber();
    lastClaimTimeSec = (await faucetContract.lastClaimTime(userAddress)).toNumber();
  }

  async function updateUI() {
    if (!lastClaimTimeSec) return;
    
    const now = Math.floor(Date.now() / 1000);
    const elapsed = now - lastClaimTimeSec;
    const progress = Math.min(1, elapsed / claimIntervalSec);
    
    const currentEarned = ethers.utils.formatUnits(rewardAmountBN.mul(Math.floor(progress * 1000000)).div(1000000), 18);
    document.getElementById("counterValue").innerText = parseFloat(currentEarned).toFixed(8);
    document.getElementById("progressFill").style.width = (progress * 100) + "%";

    const canClaim = await faucetContract.canClaim(userAddress);
    const btn = document.getElementById("claimBtn");
    const status = document.getElementById("statusText");

    if (canClaim) {
      btn.disabled = false;
      status.innerText = "–ì–æ—Ç–æ–≤–æ –¥–æ –≤–∏–ø–ª–∞—Ç–∏!";
      status.className = "status status-ok";
    } else {
      btn.disabled = true;
      const remaining = claimIntervalSec - elapsed;
      document.getElementById("timerText").innerText = "–î–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑: " + new Date(remaining * 1000).toISOString().substr(11, 8);
      status.innerText = "–ú–∞–π–Ω—ñ–Ω–≥ —É –ø—Ä–æ—Ü–µ—Å—ñ...";
      status.className = "status status-warn";
    }
  }

  async function addToken() {
    if (!window.ethereum) return alert("–ì–∞–º–∞–Ω–µ—Ü—å –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ");
    try {
        await window.ethereum.request({
          method: 'wallet_watchAsset',
          params: {
            type: 'ERC20',
            options: {
              address: TOKEN_ADDRESS,
              symbol: 'SHAG',
              decimals: 18,
              image: 'https://raw.githubusercontent.com/1SHAG/shag-site/main/assets/1shag/1SHAG_logo_512.png',
            },
          },
        });
    } catch (e) { console.error(e); }
  }

  document.getElementById("connectBtn").addEventListener("click", connect);
  document.getElementById("claimBtn").addEventListener("click", async () => {
    try {
        const tx = await faucetContract.claim();
        document.getElementById("statusText").innerText = "–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è...";
        await tx.wait();
        alert("–£—Å–ø—ñ—à–Ω–æ –æ—Ç—Ä–∏–º–∞–Ω–æ!");
        loadData();
    } catch (e) {
        console.error(e);
    }
  });
</script>
</body>
</html>
