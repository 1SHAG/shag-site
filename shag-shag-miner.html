<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–ê–ì –®–∞—Ö—Ç–∞—Ä - Web3 –ö–ª—ñ–∫–µ—Ä</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        /* –û–°–ù–û–í–ù–Ü –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø */
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #0a0e1a; color: white; text-align: center; margin: 0; padding: 20px; overflow-x: hidden; user-select: none; }
        .container { max-width: 420px; margin: 0 auto; background: #131b2e; padding: 25px; border-radius: 30px; box-shadow: 0 25px 60px rgba(0,0,0,0.7); position: relative; border: 1px solid #1f2d45; }
        
        /* –®–ê–ü–ö–ê –ó –ë–ê–õ–ê–ù–°–û–ú */
        .header-stats { display: flex; justify-content: space-between; align-items: center; font-size: 13px; background: #0f1626; padding: 12px 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #1f4a6d; }
        .balance-box b { color: #f1c40f; font-size: 15px; }
        
        /* –õ–Ü–ß–ò–õ–¨–ù–ò–ö */
        .score-container h2 { font-size: 55px; margin: 0; color: #f1c40f; text-shadow: 0 5px 15px rgba(241, 196, 15, 0.5); font-weight: 800; }
        .score-container p { margin: 5px 0 0; font-size: 12px; color: #4ecca3; letter-spacing: 3px; text-transform: uppercase; font-weight: bold; }

        /* –ó–û–ù–ê –í–ò–î–û–ë–£–¢–ö–£ (–ö–ê–ú–Ü–ù–¨) */
        .mine-area { position: relative; height: 260px; display: flex; justify-content: center; align-items: center; margin: 20px 0; }
        #rock { width: 200px; cursor: pointer; transition: transform 0.08s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 5; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5)); -webkit-tap-highlight-color: transparent; }
        #rock:active { transform: scale(0.9); filter: brightness(1.2); }

        /* –ê–ù–Ü–ú–ê–¶–Ü–Ø –¶–ò–§–† */
        .floating-number { position: absolute; color: #4ecca3; font-weight: 900; font-size: 32px; pointer-events: none; animation: floatUp 0.7s ease-out forwards; z-index: 10; text-shadow: 0 2px 5px rgba(0,0,0,0.5); }
        @keyframes floatUp { from { opacity: 1; transform: translateY(0) scale(0.8); } to { opacity: 0; transform: translateY(-140px) scale(1.2); } }

        /* –°–¢–ê–¢–ò–°–¢–ò–ö–ê */
        .stats-row { display: flex; justify-content: space-between; padding: 15px 25px; font-size: 14px; color: #8892b0; background: #0f1626; border-radius: 15px; margin-bottom: 25px; }
        .stats-row b { color: #4ecca3; font-size: 16px; }

        /* –ú–ê–ì–ê–ó–ò–ù –ü–û–ö–†–ê–©–ï–ù–¨ */
        .shop { text-align: left; }
        .upgrade-card { background: #1a233a; border-radius: 18px; padding: 10px; margin-bottom: 12px; display: flex; align-items: center; justify-content: space-between; border: 2px solid transparent; transition: 0.2s; }
        .upgrade-card:hover { border-color: #4ecca3; background: #212c45; }
        
        .card-left { display: flex; align-items: center; flex-grow: 1; }
        .upgrade-icon { width: 50px; height: 50px; margin-right: 15px; background: #0f1626; border-radius: 12px; padding: 8px; box-shadow: inset 0 2px 5px rgba(0,0,0,0.3); }
        .upgrade-info b { font-size: 15px; display: block; margin-bottom: 3px; }
        .upgrade-info span { font-size: 12px; color: #6a7a9c; }
        
        .buy-btn { background: #4ecca3; color: #0a0e1a; border: none; padding: 10px 15px; border-radius: 12px; font-weight: 800; cursor: pointer; transition: 0.2s; min-width: 80px; text-align: center; }
        .buy-btn:hover { background: #5fffd1; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(78, 204, 163, 0.4); }
        .buy-btn:active { transform: translateY(0); }

        /* –ö–ù–û–ü–ö–ò */
        .btn-withdraw { background: linear-gradient(135deg, #6a0572, #a41c9c); color: white; border: none; padding: 18px; width: 100%; border-radius: 18px; font-weight: 800; font-size: 16px; cursor: pointer; margin-top: 15px; box-shadow: 0 8px 20px rgba(106, 5, 114, 0.4); transition: 0.2s; }
        .btn-withdraw:hover { filter: brightness(1.1); transform: translateY(-2px); }
        .btn-connect { background: #4ecca3; color: #0a0e1a; border: none; padding: 12px 24px; border-radius: 12px; font-weight: bold; cursor: pointer; margin-bottom: 20px; font-size: 14px; transition: 0.2s; }
        .btn-connect:hover { background: #5fffd1; box-shadow: 0 5px 15px rgba(78, 204, 163, 0.3); }
    </style>
</head>
<body>

<div class="container">
    <div class="header-stats">
        <span id="status" style="display: flex; align-items: center;"><span style="color:#e74c3c; margin-right: 5px;">‚óè</span> –ù–µ–º–∞—î –∑–≤'—è–∑–∫—É</span>
        <span class="balance-box">–ë–∞–ª–∞–Ω—Å: <b id="shagBalance">0.00</b> –®–ê–ì</span>
    </div>

    <button id="connectBtn" class="btn-connect" onclick="connect()">‚ö° –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ –ì–∞–º–∞–Ω–µ—Ü—å</button>

    <div class="score-container">
        <h2 id="score">0</h2>
        <p>–í–ò–î–û–ë–£–¢–ò–ô –ö–ê–ú–Ü–ù–¨</p>
    </div>

    <div class="mine-area" id="mineArea">
        <img src="https://img.icons8.com/emoji/256/rock-emoji.png" id="rock" onclick="clickRock(event)" alt="–ö–∞–º—ñ–Ω—å">
    </div>

    <div class="stats-row">
        <span>–°–∏–ª–∞ –∫–ª—ñ–∫—É: <b id="pwr">+1</b></span>
        <span>–ê–≤—Ç–æ-–≤–∏–¥–æ–±—É—Ç–æ–∫: <b id="auto">0</b>/—Å</span>
    </div>

    <div class="shop">
        <div class="upgrade-card">
            <div class="card-left">
                <img src="https://img.icons8.com/plasticine/100/pickaxe.png" class="upgrade-icon" alt="–ö–∏—Ä–∫–∞">
                <div class="upgrade-info"><b>–ó–∞–ª—ñ–∑–Ω–∞ –ö–∏—Ä–∫–∞</b><span>–°–∏–ª–∞ –∫–ª—ñ–∫—É +5</span></div>
            </div>
            <button class="buy-btn" onclick="buy(1, 100)">100 –®–ì</button>
        </div>

        <div class="upgrade-card">
            <div class="card-left">
                <img src="https://img.icons8.com/dusk/100/diamond.png" class="upgrade-icon" alt="–ê–ª–º–∞–∑">
                <div class="upgrade-info"><b>–ê–ª–º–∞–∑–Ω–∞ –ö–∏—Ä–∫–∞</b><span>–°–∏–ª–∞ –∫–ª—ñ–∫—É +25</span></div>
            </div>
            <button class="buy-btn" onclick="buy(2, 500)">500 –®–ì</button>
        </div>

        <div class="upgrade-card">
            <div class="card-left">
                <img src="https://img.icons8.com/plasticine/100/worker-with-pickaxe.png" class="upgrade-icon" alt="–®–∞—Ö—Ç–∞—Ä">
                <div class="upgrade-info"><b>–ë—Ä–∏–≥–∞–¥–∞ –®–∞—Ö—Ç–∞—Ä—ñ–≤</b><span>–ê–≤—Ç–æ-–≤–∏–¥–æ–±—É—Ç–æ–∫ +10/—Å</span></div>
            </div>
            <button class="buy-btn" onclick="buy(3, 1000)">1–∫ –®–ì</button>
        </div>
    </div>

    <button class="btn-withdraw" onclick="withdraw()">üéÅ –û–±–º—ñ–Ω—è—Ç–∏ –∫–∞–º—ñ–Ω—å –Ω–∞ –®–ê–ì</button>
</div>

<script>
    // --- –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø (–ó–ê–ú–Ü–ù–Ü–¢–¨ –ù–ê –°–í–û–á –î–ê–ù–Ü) ---
    const tokenAddr = "0xd4c35feccf968f4a73be4717524c087d7d0ed229";
    const myWallet = "0x988cE6555C015e0761579de477fC9f816203ea2E"; // <-- –í–°–¢–ê–í–¢–ï –°–í–û–Æ –ê–î–†–ï–°–£
    const tgNick = "coins_1SHAG";          // <-- –í–°–¢–ê–í–¢–ï –°–í–Ü–ô –ù–Ü–ö –ë–ï–ó @

    const abi = ["function balanceOf(address o) view returns (uint256)","function decimals() view returns (uint8)","function transfer(address t, uint256 a) returns (bool)"];
    let score = 0, pwr = 1, auto = 0, provider, signer, contract, user;

    window.onload = () => {
        const s = localStorage.getItem('shag_v4_ua');
        if(s) { try { const d = JSON.parse(atob(s)); score=d.s||0; pwr=d.p||1; auto=d.a||0; } catch(e){console.log('Save error');} }
        update();
        setInterval(() => { if(auto>0){ score+=auto; update(); } }, 1000);
        setInterval(() => { save(); }, 5000);
    };

    function clickRock(e) {
        score += pwr;
        update();
        showPop(e.clientX, e.clientY, `+${pwr}`);
    }

    function showPop(x, y, txt) {
        const el = document.createElement('div');
        el.className = 'floating-number';
        el.innerText = txt;
        el.style.left = `${x - 20}px`;
        el.style.top = `${y - 60}px`;
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 700);
    }

    function update() {
        document.getElementById("score").innerText = Math.floor(score).toLocaleString('uk-UA');
        document.getElementById("pwr").innerText = "+" + pwr;
        document.getElementById("auto").innerText = auto;
    }

    function save() { localStorage.setItem('shag_v4_ua', btoa(JSON.stringify({s:score, p:pwr, a:auto}))); }

    async function connect() {
        if(!window.ethereum) return alert("MetaMask –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ!");
        try {
            provider = new ethers.BrowserProvider(window.ethereum);
            await provider.send("eth_requestAccounts", []);
            signer = await provider.getSigner();
            user = await signer.getAddress();
            contract = new ethers.Contract(tokenAddr, abi, signer);
            document.getElementById("status").innerHTML = `<span style="color:#4ecca3; margin-right: 5px;">‚óè</span> –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ: ${user.slice(0,6)}...`;
            document.getElementById("connectBtn").style.display = "none";
            updBal();
        } catch(e) { alert("–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è: " + e.message); }
    }

    async function updBal() {
        if(!contract) return;
        const b = await contract.balanceOf(user);
        const d = await contract.decimals();
        document.getElementById("shagBalance").innerText = parseFloat(ethers.formatUnits(b, d)).toFixed(2);
    }

    async function buy(t, pr) {
        if(!contract) return alert("–°–ø–æ—á–∞—Ç–∫—É –ø—ñ–¥–∫–ª—é—á—ñ—Ç—å –≥–∞–º–∞–Ω–µ—Ü—å!");
        if(!confirm(`–ö—É–ø–∏—Ç–∏ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –∑–∞ ${pr} –®–ê–ì?`)) return;
        try {
            const d = await contract.decimals();
            const tx = await contract.transfer(myWallet, ethers.parseUnits(pr.toString(), d));
            alert("–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –º–µ—Ä–µ–∂—É. –û—á—ñ–∫—É–π—Ç–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è...");
            await tx.wait();
            if(t===1) pwr+=5; if(t===2) pwr+=25; if(t===3) auto+=10;
            save(); update(); updBal();
            alert("‚úÖ –£—Å–ø—ñ—à–Ω–æ –∫—É–ø–ª–µ–Ω–æ! –í–∞—à–∞ —Å–∏–ª–∞ –≤–∏–¥–æ–±—É—Ç–∫—É –∑—Ä–æ—Å–ª–∞.");
        } catch(e) { alert("–ü–æ–º–∏–ª–∫–∞ –æ–ø–ª–∞—Ç–∏ –∞–±–æ —Å–∫–∞—Å–æ–≤–∞–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º."); }
    }

    function withdraw() {
    if (!user) {
        alert("–°–ø–æ—á–∞—Ç–∫—É –ø—ñ–¥–∫–ª—é—á—ñ—Ç—å –≥–∞–º–∞–Ω–µ—Ü—å!");
        return;
    }
    
    if (score < 10) {
        alert("–ü–æ—Ç—Ä—ñ–±–Ω–æ –º—ñ–Ω—ñ–º—É–º 1000 –∫–∞–º–µ–Ω—é –¥–ª—è –æ–±–º—ñ–Ω—É!");
        return;
    }

    const amountToPay = Math.floor(score / 100);
    const confirmation = confirm(`–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ? –û–±–º—ñ–Ω—è—Ç–∏ ${Math.floor(score)} –∫–∞–º–µ–Ω—é –Ω–∞ ${amountToPay} –®–ê–ì?`);
    
    if (confirmation) {
        // –§–æ—Ä–º—É—î–º–æ —Ç–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ —á–µ—Ä–µ–∑ encodeURIComponent
        const messageText = `üëã –ü—Ä–∏–≤—ñ—Ç! –ó–∞—è–≤–∫–∞ –Ω–∞ –≤–∏–≤—ñ–¥ —Ç–æ–∫–µ–Ω—ñ–≤ –®–ê–ì\n` +
                          `--------------------------\n` +
                          `üí∞ –î–æ –≤–∏–ø–ª–∞—Ç–∏: ${amountToPay} –®–ê–ì\n` +
                          `‚õèÔ∏è –°–ø–∏—Å–∞–Ω–æ –∫–∞–º–µ–Ω—é: ${Math.floor(score)}\n` +
                          `üíº –ì–∞–º–∞–Ω–µ—Ü—å: ${user}\n` +
                          `üîê –ö–æ–¥: ${Math.floor(Math.random() * 90000) + 10000}`;

        // –°–ø–∏—Å—É—î–º–æ –æ—á–∫–∏ –≤ –≥—Ä—ñ
        score = 0;
        save();
        update();

        // –°–ø—Ä–æ–±–∞ ‚Ññ1: –í—ñ–¥–∫—Ä–∏—Ç–∏ –ø—Ä—è–º–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —á–∞—Ç –∑ —Ç–µ–∫—Å—Ç–æ–º
        const telegramUrl = `https://t.me/${tgNick}?text=${encodeURIComponent(messageText)}`;
        
        const newWindow = window.open(telegramUrl, '_blank');

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –≤—ñ–¥–∫—Ä–∏–ª–æ—Å—è –≤—ñ–∫–Ω–æ (—è–∫—â–æ –∑–∞–±–ª–æ–∫—É–≤–∞–≤ –±—Ä–∞—É–∑–µ—Ä)
        if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
            // –°–ø—Ä–æ–±–∞ ‚Ññ2: –Ø–∫—â–æ –≤—ñ–∫–Ω–æ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ, –ø—Ä–æ—Å—Ç–æ –∫–æ–ø—ñ—é—î–º–æ –¥–∞–Ω—ñ —ñ –ø—Ä–æ—Å–∏–º–æ –ø–µ—Ä–µ–π—Ç–∏ –≤—Ä—É—á–Ω—É
            navigator.clipboard.writeText(messageText).then(() => {
                alert("–ë—Ä–∞—É–∑–µ—Ä –∑–∞–±–ª–æ–∫—É–≤–∞–≤ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è Telegram. \n\n–î–∞–Ω—ñ –¥–ª—è –≤–∏–≤–æ–¥—É —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É! –ë—É–¥—å –ª–∞—Å–∫–∞, –ø–µ—Ä–µ–π–¥—ñ—Ç—å –≤ —á–∞—Ç –¥–æ –∞–¥–º—ñ–Ω–∞ —ñ –≤—Å—Ç–∞–≤—Ç–µ —Ç–µ–∫—Å—Ç (Ctrl+V).");
                window.location.href = `https://t.me/${tgNick}`;
            });
        }
    }
}
</script>
</body>
</html>
