<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–ê–ì –®–∞—Ö—Ç–∞—Ä - Web3 Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #0a0e1a; color: white; text-align: center; margin: 0; padding: 20px; user-select: none; }
        .container { max-width: 420px; margin: 0 auto; background: #131b2e; padding: 25px; border-radius: 30px; box-shadow: 0 25px 60px rgba(0,0,0,0.7); border: 1px solid #1f2d45; }
        
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); }
        .modal-content { background: #16213e; margin: 15% auto; padding: 25px; border-radius: 20px; width: 85%; max-width: 320px; border: 1px solid #4ecca3; }
        #copyText { background: #0a0e1a; padding: 12px; border-radius: 10px; font-size: 11px; text-align: left; margin: 15px 0; border: 1px solid #1f4a6d; color: #4ecca3; font-family: monospace; white-space: pre-wrap; line-height: 1.4; }

        .header-stats { display: flex; justify-content: space-between; align-items: center; font-size: 13px; background: #0f1626; padding: 12px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #1f4a6d; }
        .balance-box b { color: #f1c40f; }
        
        #boostTimerBox { display: none; background: linear-gradient(90deg, #e74c3c, #c0392b); padding: 12px; border-radius: 15px; margin-bottom: 15px; font-weight: bold; font-size: 18px; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }

        /* –°–¢–ò–õ–Ü –®–ö–ê–õ–ò –ü–ï–†–ï–ì–†–Ü–í–£ */
        .temp-container { width: 280px; height: 18px; background: #0f1626; border-radius: 10px; margin: 15px auto; border: 1px solid #1f4a6d; overflow: hidden; position: relative; }
        .temp-bar { width: 0%; height: 100%; background: linear-gradient(90deg, #f1c40f, #e74c3c); transition: width 0.2s ease-out; }
        .temp-label { position: absolute; width: 100%; top: 3px; left: 0; font-size: 9px; font-weight: bold; color: white; text-transform: uppercase; letter-spacing: 1px; text-shadow: 1px 1px 2px black; pointer-events: none; }
        .overheat-blink { animation: blink-bg 0.4s infinite; }
        @keyframes blink-bg { 0% { background: #e74c3c; } 50% { background: #330000; } 100% { background: #e74c3c; } }

        .score-container h2 { font-size: 45px; margin: 0; color: #f1c40f; text-shadow: 0 5px 15px rgba(241, 196, 15, 0.4); }
        
        .mine-area { position: relative; height: 300px; display: flex; justify-content: center; align-items: center; margin: 10px 0; }
        #rock { 
            width: 260px; height: 260px; cursor: pointer; transition: transform 0.05s; z-index: 5; border-radius: 50%; object-fit: cover; box-shadow: 0 0 30px rgba(241, 196, 15, 0.3); -webkit-tap-highlight-color: transparent; 
        }
        #rock:active { transform: scale(0.95); }
        .boost-active-img { filter: drop-shadow(0 0 20px #e74c3c) !important; border: 3px solid #e74c3c !important; }

        .floating-number { position: absolute; color: #4ecca3; font-weight: bold; font-size: 30px; pointer-events: none; animation: floatUp 0.7s ease-out forwards; z-index: 10; }
        .floating-number.boosted { color: #e74c3c; font-size: 45px; text-shadow: 0 0 10px rgba(231,76,60,0.5); } 
        @keyframes floatUp { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-130px); } }

        .stats-row { display: flex; justify-content: space-around; font-size: 13px; color: #8892b0; margin-bottom: 20px; background: #0f1626; padding: 10px; border-radius: 12px; }
        .stats-row b { color: #4ecca3; }

        .shop { text-align: left; }
        .upgrade-card { background: #1a233a; border-radius: 15px; padding: 15px; margin-bottom: 12px; border: 1px solid #252f47; }
        .upgrade-card.gold-vein { border: 1px solid #e74c3c; background: linear-gradient(135deg, #1a233a 0%, #2c1a1a 100%); }
        .upgrade-icon { width: 60px; height: 60px; margin-right: 12px; border-radius: 50%; object-fit: cover; border: 1px solid #333; }
        
        .shop-actions { display: flex; flex-direction: column; gap: 6px; min-width: 90px; }
        .buy-btn { background: #4ecca3; color: #0a0e1a; border: none; padding: 8px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 12px; }
        .buy-btn.stone { background: #f1c40f; }
        .buy-btn.boost { background: #e74c3c; color: white; }
        
        .btn-withdraw { background: linear-gradient(45deg, #6a0572, #a34293); color: white; border: none; padding: 16px; width: 100%; border-radius: 15px; font-weight: bold; font-size: 15px; cursor: pointer; margin-top: 5px; }
        .btn-connect { background: #4ecca3; color: #0a0e1a; border: none; padding: 12px 24px; border-radius: 12px; font-weight: bold; cursor: pointer; margin-bottom: 20px; }
    </style>
</head>
<body>

<div id="withdrawModal" class="modal">
    <div class="modal-content">
        <h3 style="margin-top:0; color:#4ecca3">üìã –ó–∞—è–≤–∫–∞ —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–∞</h3>
        <div id="copyText"></div>
        <button class="buy-btn" style="width:100%; padding:16px; font-size:14px" onclick="copyAndGo()">–°–ö–û–ü–Ü–Æ–í–ê–¢–ò –¢–ê –í –¢–ï–õ–ï–ì–†–ê–ú</button>
        <button style="background:none; border:none; color:#8892b0; margin-top:15px; cursor:pointer;" onclick="closeModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    </div>
</div>

<div class="container">
    <div class="header-stats">
        <span id="status">üîå –ù–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ</span>
        <span class="balance-box">–ë–∞–ª–∞–Ω—Å: <b id="shagBalance">0.00</b> –®–ê–ì</span>
    </div>
    
    <div id="boostTimerBox">
        üöÄ –ó–û–õ–û–¢–ê –ñ–ò–õ–ê: <span id="boostTimer">100</span> –°–ï–ö
    </div>

    <button id="connectBtn" class="btn-connect" onclick="connect()">‚ö° –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ –ì–∞–º–∞–Ω–µ—Ü—å</button>

    <div class="score-container">
        <h2 id="score">0</h2>
        <p style="color:#4ecca3; font-size:10px; letter-spacing:2px; font-weight:bold; margin-top:5px">–í–ò–î–û–ë–£–¢–ò–ô –ö–ê–ú–Ü–ù–¨</p>
    </div>

    <div class="temp-container">
        <div id="temp-bar" class="temp-bar"></div>
        <div id="temp-label" class="temp-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —à–∞—Ö—Ç–∏</div>
    </div>

    <div class="mine-area">
        <img src="assets/1shag/rock.png" id="rock" onclick="clickRock(event)" alt="–í–∏–¥–æ–±—É—Ç–æ–∫">
    </div>

    <div class="stats-row">
        <span>–ö–ª—ñ–∫: <b id="pwrDisplay">+1</b></span>
        <span>–ê–≤—Ç–æ: <b id="autoDisplay">0</b>/—Å</span>
    </div>

    <div class="shop">
        <div class="upgrade-card gold-vein">
            <div style="display:flex; align-items:center; justify-content: space-between;">
                <div style="display:flex; align-items:center">
                    <div class="upgrade-icon" style="background:#e74c3c; display:flex; align-items:center; justify-content:center; font-size:25px;">üî•</div>
                    <div style="text-align:left"><b style="font-size:20px; color:#e74c3c">–ó–æ–ª–æ—Ç–∞ –ñ–∏–ª–∞</b><br><span style="font-size:11px; color:#fff">—Ö10 –≤–∏–¥–æ–±—É—Ç–æ–∫ –Ω–∞ 100 —Å–µ–∫</span></div>
                </div>
                <div class="shop-actions">
                    <button class="buy-btn boost" onclick="buyBoost()">10 –®–ê–ì</button>
                </div>
            </div>
        </div>

        <div class="upgrade-card">
            <div style="display:flex; align-items:center; justify-content: space-between;">
                <div style="display:flex; align-items:center">
                    <img src="assets/1shag/pickaxe_iron.png" class="upgrade-icon">
                    <div style="text-align:left"><b style="font-size:20px">–ó–∞–ª—ñ–∑–Ω–∞ –ö–∏—Ä–∫–∞</b><br><span style="font-size:11px; color:#8892b0">+5 –¥–æ –∫–ª—ñ–∫—É</span></div>
                </div>
                <div class="shop-actions">
                    <button class="buy-btn" onclick="buy(1, 100)">100 –®–ê–ì</button>
                    <button class="buy-btn stone" onclick="buyWithStone(1, 1000000)">1–ú –∫–∞–º—ñ–Ω—å</button>
                </div>
            </div>
        </div>

        <div class="upgrade-card">
            <div style="display:flex; align-items:center; justify-content: space-between;">
                <div style="display:flex; align-items:center">
                    <img src="assets/1shag/pickaxe_diamond.png" class="upgrade-icon">
                    <div style="text-align:left"><b style="font-size:20px">–ê–ª–º–∞–∑–Ω–∞ –ö–∏—Ä–∫–∞</b><br><span style="font-size:11px; color:#8892b0">+25 –¥–æ –∫–ª—ñ–∫—É</span></div>
                </div>
                <div class="shop-actions">
                    <button class="buy-btn" onclick="buy(2, 500)">500 –®–ê–ì</button>
                    <button class="buy-btn stone" onclick="buyWithStone(2, 5000000)">5–ú –∫–∞–º—ñ–Ω—å</button>
                </div>
            </div>
        </div>

        <div class="upgrade-card">
            <div style="display:flex; align-items:center; justify-content: space-between;">
                <div style="display:flex; align-items:center">
                    <img src="assets/1shag/hedgehogs.png" class="upgrade-icon">
                    <div style="text-align:left"><b style="font-size:20px">–ë—Ä–∏–≥–∞–¥–∞ –á–∂–∞—á–∫—ñ–≤</b><br><span style="font-size:11px; color:#8892b0">+10/—Å –∞–≤—Ç–æ</span></div>
                </div>
                <div class="shop-actions">
                    <button class="buy-btn" onclick="buy(3, 1000)">1–∫ –®–ê–ì</button>
                    <button class="buy-btn stone" onclick="buyWithStone(3, 10000000)">10–ú –∫–∞–º—ñ–Ω—å</button>
                </div>
            </div>
        </div>
    </div>

    <p style="color: #8892b0; font-size: 11px; margin-top: 20px; font-weight: bold; text-transform: uppercase;">–ö—É—Ä—Å: 100 000 –∫–∞–º—ñ–Ω—å = 10 –®–ê–ì</p>
    <button class="btn-withdraw" onclick="withdraw()">üéÅ –û–ë–ú–Ü–ù–Ø–¢–ò –ö–ê–ú–Ü–ù–¨ –ù–ê –®–ê–ì</button>
</div>

<script>
    const tokenAddr = "0xd4c35feccf968f4a73be4717524c087d7d0ed229";
    const myWallet = "0x988cE6555C015e0761579de477fC9f816203ea2E";
    const tgNick = "coins_1SHAG";

    const abi = ["function balanceOf(address o) view returns (uint256)","function decimals() view returns (uint8)","function transfer(address t, uint256 a) returns (bool)"];
    let score = 0, pwr = 1, auto = 0, user, contract, pendingMsg = "", oldScore = 0;
    let boostMultiplier = 1, boostEndTime = 0, boostInterval;

    // –ó–º—ñ–Ω–Ω—ñ –ø–µ—Ä–µ–≥—Ä—ñ–≤—É
    let temperature = 0;
    const maxTemp = 100;
    const heatPerClick = 1.5;  // –ë–ª–∏–∑—å–∫–æ 26 —à–≤–∏–¥–∫–∏—Ö –∫–ª—ñ–∫—ñ–≤ –¥–æ –ø–µ—Ä–µ–≥—Ä—ñ–≤—É
    const coolingRate = 9;     // –°–∫—ñ–ª—å–∫–∏ % –æ—Ö–æ–ª–æ–¥–∂—É—î—Ç—å—Å—è –∑–∞ —Å–µ–∫—É–Ω–¥—É
    let isOverheated = false;

    window.onload = () => {
        const saved = localStorage.getItem('shag_v_ultra');
        if(saved) { 
            try {
                const d = JSON.parse(atob(saved)); 
                score = d.s || 0; pwr = d.p || 1; auto = d.a || 0; boostEndTime = d.be || 0; 
                if (Date.now() < boostEndTime) startBoostTimer();
                updateMainImage();
            } catch(e) {}
        }
        updateUI();

        // –¶–∏–∫–ª –∞–≤—Ç–æ–≤–∏–¥–æ–±—É—Ç–∫—É
        setInterval(() => { 
            if(auto > 0){ 
                score += (auto * boostMultiplier); 
                updateUI(); 
            } 
        }, 1000);

        // –¶–∏–∫–ª –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è —à–∞—Ö—Ç–∏
        setInterval(() => {
            if (temperature > 0) {
                temperature = Math.max(0, temperature - coolingRate);
                updateTempUI();
            }
        }, 1000);
    };

    function startBoostTimer() {
        boostMultiplier = 10;
        document.getElementById("boostTimerBox").style.display = "block";
        document.getElementById("rock").classList.add("boost-active-img");
        if (boostInterval) clearInterval(boostInterval);
        boostInterval = setInterval(() => {
            let remain = boostEndTime - Date.now();
            if (remain <= 0) {
                clearInterval(boostInterval);
                boostMultiplier = 1;
                document.getElementById("boostTimerBox").style.display = "none";
                document.getElementById("rock").classList.remove("boost-active-img");
                updateUI();
                return;
            }
            document.getElementById("boostTimer").innerText = Math.ceil(remain / 1000);
        }, 100);
    }

    function updateMainImage() {
        const mainImg = document.getElementById("rock");
        if(auto > 0) mainImg.src = "assets/1shag/hedgehogs.png";
        else if(pwr > 25) mainImg.src = "assets/1shag/pickaxe_diamond.png";
        else if(pwr > 1) mainImg.src = "assets/1shag/pickaxe_iron.png";
        else mainImg.src = "assets/1shag/rock.png";
    }

    function clickRock(e) {
        if (isOverheated) return; // –Ø–∫—â–æ –ø–µ—Ä–µ–≥—Ä—ñ–≤ ‚Äî –∫–ª—ñ–∫ –Ω–µ –ø—Ä–∞—Ü—é—î

        // –ù–∞–≥—Ä—ñ–≤–∞—î–º–æ —à–∞—Ö—Ç—É
        temperature += heatPerClick;
        updateTempUI();

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—É —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É
        if (temperature >= maxTemp) {
            triggerOverheat();
            return;
        }

        let earned = pwr * boostMultiplier;
        score += earned;
        updateUI();
        const num = document.createElement('div');
        num.className = 'floating-number' + (boostMultiplier > 1 ? ' boosted' : '');
        num.innerText = `+${earned}`;
        num.style.left = `${e.clientX - 20}px`;
        num.style.top = `${e.clientY - 40}px`;
        document.body.appendChild(num);
        setTimeout(() => num.remove(), 700);
    }

    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —à–∫–∞–ª–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏
    function updateTempUI() {
        const bar = document.getElementById("temp-bar");
        bar.style.width = temperature + "%";
    }

    // –§—É–Ω–∫—Ü—ñ—è –ü–ï–†–ï–ì–†–Ü–í–£
    function triggerOverheat() {
        isOverheated = true;
        temperature = maxTemp;
        updateTempUI();
        
        const bar = document.getElementById("temp-bar");
        const label = document.getElementById("temp-label");
        
        bar.classList.add("overheat-blink");
        label.innerText = "üö® –ü–ï–†–ï–ì–†–Ü–í! –ó–ê–ß–ï–ö–ê–ô–¢–ï 10 –°–ï–ö...";
        label.style.color = "#ff4400";

        setTimeout(() => {
            isOverheated = false;
            temperature = 0;
            bar.classList.remove("overheat-blink");
            label.innerText = "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —à–∞—Ö—Ç–∏";
            label.style.color = "white";
            updateTempUI();
        }, 10000); // –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –Ω–∞ 10 —Å–µ–∫—É–Ω–¥
    }

    function updateUI() {
        document.getElementById("score").innerText = Math.floor(score).toLocaleString('uk-UA');
        document.getElementById("pwrDisplay").innerText = `+${pwr * boostMultiplier}`;
        document.getElementById("autoDisplay").innerText = auto * boostMultiplier;
        localStorage.setItem('shag_v_ultra', btoa(JSON.stringify({s:score, p:pwr, a:auto, be:boostEndTime})));
    }

    async function connect() {
        if(!window.ethereum) return alert("–í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å MetaMask!");
        const p = new ethers.BrowserProvider(window.ethereum);
        const s = await p.getSigner();
        user = await s.getAddress();
        contract = new ethers.Contract(tokenAddr, abi, s);
        document.getElementById("status").innerText = "üü¢ " + user.slice(0,6);
        document.getElementById("connectBtn").style.display = "none";
        updBal();
    }

    async function updBal() {
        if(!contract) return;
        const b = await contract.balanceOf(user), d = await contract.decimals();
        document.getElementById("shagBalance").innerText = parseFloat(ethers.formatUnits(b, d)).toFixed(2);
    }

    async function buy(t, pr) {
        if(!contract) return alert("–ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –≥–∞–º–∞–Ω–µ—Ü—å!");
        try {
            const d = await contract.decimals();
            const tx = await contract.transfer(myWallet, ethers.parseUnits(pr.toString(), d));
            await tx.wait();
            if(t === 1) pwr += 5; else if(t === 2) pwr += 25; else if(t === 3) auto += 10;
            updateMainImage(); updateUI(); updBal();
            alert("‚úÖ –£—Å–ø—ñ—à–Ω–æ –∫—É–ø–ª–µ–Ω–æ!");
        } catch(e) { alert("–ü–æ–º–∏–ª–∫–∞ –æ–ø–ª–∞—Ç–∏"); }
    }

    async function buyBoost() {
        if(!contract) return alert("–ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –≥–∞–º–∞–Ω–µ—Ü—å!");
        if(boostMultiplier > 1) return alert("–ë—É—Å—Ç –≤–∂–µ –∞–∫—Ç–∏–≤–Ω–∏–π!");
        try {
            const d = await contract.decimals();
            const tx = await contract.transfer(myWallet, ethers.parseUnits("10", d));
            await tx.wait();
            boostEndTime = Date.now() + (100 * 1000);
            startBoostTimer();
            updateUI(); updBal();
            alert("üî• –ó–û–õ–û–¢–ê –ñ–ò–õ–ê –ê–ö–¢–ò–í–û–í–ê–ù–ê!");
        } catch(e) { alert("–ü–æ–º–∏–ª–∫–∞ –æ–ø–ª–∞—Ç–∏"); }
    }

    function buyWithStone(t, price) {
        if (score < price) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–∞–º–µ–Ω—é!");
        if (confirm("–ö—É–ø–∏—Ç–∏ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –∑–∞ " + price.toLocaleString() + " –∫–∞–º–µ–Ω—é?")) {
            score -= price;
            if(t === 1) pwr += 5; else if(t === 2) pwr += 25; else if(t === 3) auto += 10;
            updateMainImage(); updateUI();
        }
    }

    function withdraw() {
        if(!user || score < 100000) return alert("–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–æ 100 000 –∫–∞–º–µ–Ω—é!");
        oldScore = score;
        const amount = Math.floor(score / 10000), code = Math.floor(10000 + Math.random() * 89999);
        pendingMsg = `üëã –ó–ê–Ø–í–ö–ê\nüí∞ –°—É–º–∞: ${amount} –®–ê–ì\n‚õèÔ∏è –ö–∞–º—ñ–Ω—å: ${Math.floor(score)}\nüíº –ì–∞–º–∞–Ω–µ—Ü—å: ${user}\nüîê –ö–æ–¥: ${code}`;
        document.getElementById("copyText").innerText = pendingMsg;
        document.getElementById("withdrawModal").style.display = "block";
        score = 0; updateUI();
    }

    function copyAndGo() {
        navigator.clipboard.writeText(pendingMsg).then(() => {
            oldScore = 0;
            localStorage.setItem('shag_v_ultra', btoa(JSON.stringify({s:0, p:pwr, a:auto, be:boostEndTime})));
            window.open(`https://t.me/${tgNick}`, '_blank');
            document.getElementById("withdrawModal").style.display = "none";
        });
    }

    function closeModal() { if (oldScore > 0) score = oldScore; updateUI(); document.getElementById("withdrawModal").style.display = "none"; }
</script>
</body>
</html>
