<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–ê–ì –®–∞—Ö—Ç–∞—Ä - Web3 –ö–ª—ñ–∫–µ—Ä</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #0a0e1a; color: white; text-align: center; margin: 0; padding: 20px; user-select: none; }
        .container { max-width: 400px; margin: 0 auto; background: #131b2e; padding: 25px; border-radius: 30px; box-shadow: 0 25px 60px rgba(0,0,0,0.7); border: 1px solid #1f2d45; }
        
        /* –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ */
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); }
        .modal-content { background: #16213e; margin: 20% auto; padding: 25px; border-radius: 20px; width: 85%; max-width: 320px; border: 1px solid #4ecca3; }
        #copyText { background: #0a0e1a; padding: 10px; border-radius: 10px; font-size: 12px; text-align: left; white-space: pre-wrap; margin: 15px 0; border: 1px solid #1f4a6d; color: #4ecca3; font-family: monospace; }

        /* –ì—Ä–∞—Ñ—ñ–∫–∞ */
        .header-stats { display: flex; justify-content: space-between; font-size: 13px; background: #0f1626; padding: 12px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #1f4a6d; }
        .score-container h2 { font-size: 50px; margin: 0; color: #f1c40f; text-shadow: 0 5px 15px rgba(241, 196, 15, 0.4); }
        
        .mine-area { position: relative; height: 220px; display: flex; justify-content: center; align-items: center; }
        #rock { width: 180px; cursor: pointer; transition: transform 0.05s; z-index: 5; -webkit-tap-highlight-color: transparent; }
        #rock:active { transform: scale(0.9); }

        .floating-number { position: absolute; color: #4ecca3; font-weight: bold; font-size: 28px; pointer-events: none; animation: floatUp 0.7s ease-out forwards; z-index: 10; }
        @keyframes floatUp { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-120px); } }

        /* –ö–Ω–æ–ø–∫–∏ —Ç–∞ –ú–∞–≥–∞–∑–∏–Ω */
        .upgrade-card { background: #1a233a; border-radius: 15px; padding: 10px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; border: 1px solid transparent; cursor: pointer; }
        .upgrade-card:hover { border-color: #4ecca3; }
        .upgrade-icon { width: 40px; height: 40px; margin-right: 10px; }
        .buy-btn { background: #4ecca3; color: #0a0e1a; border: none; padding: 8px 12px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        
        .btn-withdraw { background: linear-gradient(45deg, #6a0572, #a34293); color: white; border: none; padding: 15px; width: 100%; border-radius: 15px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-connect { background: #4ecca3; color: #0a0e1a; border: none; padding: 10px 20px; border-radius: 10px; font-weight: bold; cursor: pointer; margin-bottom: 15px; }
    </style>
</head>
<body>

<div id="withdrawModal" class="modal">
    <div class="modal-content">
        <h3 style="margin-top:0">üìã –ó–∞—è–≤–∫–∞ –≥–æ—Ç–æ–≤–∞</h3>
        <p style="font-size: 12px; color: #8892b0;">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ, —â–æ–± —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –¥–∞–Ω—ñ —Ç–∞ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ —ó—Ö –∞–¥–º—ñ–Ω—É –≤ —á–∞—Ç.</p>
        <div id="copyText"></div>
        <button class="buy-btn" style="width:100%; padding:15px" onclick="copyAndGo()">–°–ö–û–ü–Ü–Æ–í–ê–¢–ò –¢–ê –í–Ü–î–ö–†–ò–¢–ò –¢–ì</button>
        <button style="background:none; border:none; color:#8892b0; margin-top:15px; cursor:pointer" onclick="closeModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    </div>
</div>

<div class="container">
    <div class="header-stats">
        <span id="status">üîå –ù–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ</span>
        <span><b id="shagBalance">0.00</b> –®–ê–ì</span>
    </div>

    <button id="connectBtn" class="btn-connect" onclick="connect()">–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ –ì–∞–º–∞–Ω–µ—Ü—å</button>

    <div class="score-container">
        <h2 id="score">0</h2>
        <p style="color:#4ecca3; font-size:12px; letter-spacing:2px">–í–ò–î–û–ë–£–¢–ò–ô –ö–ê–ú–Ü–ù–¨</p>
    </div>

    <div class="mine-area">
        <img src="https://img.icons8.com/emoji/256/rock-emoji.png" id="rock" onclick="clickRock(event)">
    </div>

    <div style="display:flex; justify-content:space-around; font-size:13px; color:#8892b0; margin-bottom:15px">
        <span>–ö–ª—ñ–∫: <b id="pwr">+1</b></span>
        <span>–ê–≤—Ç–æ: <b id="auto">0</b>/—Å</span>
    </div>

    <div class="shop">
        <div class="upgrade-card">
            <div style="display:flex; align-items:center">
                <img src="https://img.icons8.com/plasticine/100/pickaxe.png" class="upgrade-icon">
                <div style="text-align:left"><b style="font-size:14px">–ö–∏—Ä–∫–∞</b><br><span style="font-size:11px">+5 –¥–æ –∫–ª—ñ–∫—É</span></div>
            </div>
            <button class="buy-btn" onclick="buy(1, 100)">100 –®–ì</button>
        </div>
        <div class="upgrade-card">
            <div style="display:flex; align-items:center">
                <img src="https://img.icons8.com/plasticine/100/worker-with-pickaxe.png" class="upgrade-icon">
                <div style="text-align:left"><b style="font-size:14px">–ë—Ä–∏–≥–∞–¥–∞</b><br><span style="font-size:11px">+10/—Å –∞–≤—Ç–æ</span></div>
            </div>
            <button class="buy-btn" onclick="buy(3, 1000)">1–∫ –®–ì</button>
        </div>
    </div>

    <button class="btn-withdraw" onclick="withdraw()">üéÅ –û–ë–ú–Ü–ù–Ø–¢–ò –ö–ê–ú–Ü–ù–¨ –ù–ê –®–ê–ì</button>
</div>

<script>
    // --- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø ---
    const tokenAddr = "0xd4c35feccf968f4a73be4717524c087d7d0ed229";
    const myWallet = "0x988cE6555C015e0761579de477fC9f816203ea2E"; // –í–°–¢–ê–í–¢–ï –°–í–û–Æ
    const tgNick = "coins_1SHAG";   // –í–°–¢–ê–í–¢–ï –°–í–Ü–ô –¢–ì –ù–Ü–ö

    const abi = ["function balanceOf(address o) view returns (uint256)","function decimals() view returns (uint8)","function transfer(address t, uint256 a) returns (bool)"];
    let score = 0, pwr = 1, auto = 0, user, contract, pendingMsg = "";

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
    window.onload = () => {
        const saved = localStorage.getItem('shag_vfinal');
        if(saved) { const d = JSON.parse(atob(saved)); score=d.s; pwr=d.p; auto=d.a; }
        update();
        setInterval(() => { if(auto>0){ score+=auto; update(); } }, 1000);
    };

    function clickRock(e) {
        score += pwr;
        update();
        const num = document.createElement('div');
        num.className = 'floating-number';
        num.innerText = `+${pwr}`;
        num.style.left = `${e.clientX - 20}px`;
        num.style.top = `${e.clientY - 40}px`;
        document.body.appendChild(num);
        setTimeout(() => num.remove(), 700);
    }

    function update() {
        document.getElementById("score").innerText = Math.floor(score).toLocaleString();
        document.getElementById("pwr").innerText = `+${pwr}`;
        document.getElementById("auto").innerText = auto;
        localStorage.setItem('shag_vfinal', btoa(JSON.stringify({s:score, p:pwr, a:auto})));
    }

    async function connect() {
        if(!window.ethereum) return alert("–í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å MetaMask!");
        const p = new ethers.BrowserProvider(window.ethereum);
        await p.send("eth_requestAccounts", []);
        const s = await p.getSigner();
        user = await s.getAddress();
        contract = new ethers.Contract(tokenAddr, abi, s);
        document.getElementById("status").innerText = "üü¢ " + user.slice(0,6);
        document.getElementById("connectBtn").style.display = "none";
    }

    async function buy(t, pr) {
        if(!contract) return alert("–ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –≥–∞–º–∞–Ω–µ—Ü—å!");
        try {
            const tx = await contract.transfer(myWallet, ethers.parseUnits(pr.toString(), 18));
            await tx.wait();
            if(t===1) pwr+=5; else auto+=10;
            update(); alert("–ö—É–ø–ª–µ–Ω–æ!");
        } catch(e) { alert("–ü–æ–º–∏–ª–∫–∞ –æ–ø–ª–∞—Ç–∏"); }
    }

    function withdraw() {
        if(!user) return alert("–ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –≥–∞–º–∞–Ω–µ—Ü—å!");
        if(score < 10) return alert("–ü–æ—Ç—Ä—ñ–±–Ω–æ 10 –∫–∞–º–µ–Ω—é!");
        
        const s = Math.floor(score/1);
        pendingMsg = `üëã –ó–ê–Ø–í–ö–ê –ù–ê –í–ò–í–Ü–î\nüí∞ –°—É–º–∞: ${s} –®–ê–ì\n‚õèÔ∏è –ö–∞–º—ñ–Ω—å: ${Math.floor(score)}\nüíº –ì–∞–º–∞–Ω–µ—Ü—å: ${user}\nüîê –ö–æ–¥: ${Math.floor(Math.random()*99999)}`;
        
        document.getElementById("copyText").innerText = pendingMsg;
        document.getElementById("withdrawModal").style.display = "block";
        
        score = 0;
        update();
    }

    function closeModal() { document.getElementById("withdrawModal").style.display = "none"; }

    function copyAndGo() {
        navigator.clipboard.writeText(pendingMsg).then(() => {
            alert("–î–∞–Ω—ñ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ! –¢–µ–ø–µ—Ä –≤—Å—Ç–∞–≤—Ç–µ —ó—Ö —É —á–∞—Ç.");
            window.open(`https://t.me/${tgNick}`, '_blank');
            closeModal();
        });
    }
</script>
</body>
</html>
