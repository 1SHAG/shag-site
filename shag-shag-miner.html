<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–ê–ì –®–∞—Ö—Ç–∞—Ä - Web3 –ö–ª—ñ–∫–µ—Ä</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #1a1a2e; color: white; text-align: center; margin: 0; padding: 20px; overflow: hidden; user-select: none; }
        .container { max-width: 400px; margin: 0 auto; background: #16213e; padding: 20px; border-radius: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); position: relative; }
        
        /* –®–∞–ø–∫–∞ –∑ –±–∞–ª–∞–Ω—Å–æ–º */
        .header-stats { display: flex; justify-content: space-between; font-size: 12px; background: #0f3460; padding: 15px; border-radius: 20px; margin-bottom: 20px; border: 1px solid #4ecca3; }
        
        /* –õ—ñ—á–∏–ª—å–Ω–∏–∫ */
        .score-container h2 { font-size: 50px; margin: 0; color: #f1c40f; text-shadow: 0 4px 10px rgba(241, 196, 15, 0.4); }
        .score-container p { margin: 0; font-size: 12px; color: #4ecca3; letter-spacing: 2px; }

        /* –ö–∞–º—ñ–Ω—å —Ç–∞ –∞–Ω—ñ–º–∞—Ü—ñ—è –∫–ª—ñ–∫—É */
        .mine-area { position: relative; height: 250px; display: flex; justify-content: center; align-items: center; }
        #rock { width: 180px; cursor: pointer; transition: transform 0.05s; z-index: 5; -webkit-tap-highlight-color: transparent; }
        #rock:active { transform: scale(0.9); }

        /* –¶–∏—Ñ—Ä–∏, —â–æ –≤–∏–ª—ñ—Ç–∞—é—Ç—å */
        .floating-number { position: absolute; color: #4ecca3; font-weight: bold; font-size: 28px; pointer-events: none; animation: floatUp 0.7s ease-out forwards; z-index: 10; }
        @keyframes floatUp { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-120px); } }

        /* –ú–∞–≥–∞–∑–∏–Ω */
        .shop { margin-top: 20px; text-align: left; }
        .upgrade-card { background: #0f3460; border-radius: 15px; padding: 12px; margin-bottom: 10px; display: flex; align-items: center; border: 1px solid transparent; cursor: pointer; transition: 0.2s; }
        .upgrade-card:hover { border-color: #4ecca3; background: #1e5128; }
        .upgrade-icon { width: 45px; height: 45px; margin-right: 15px; background: #16213e; border-radius: 10px; padding: 5px; }
        .upgrade-info { flex-grow: 1; }
        .upgrade-info b { font-size: 14px; display: block; }
        .upgrade-info span { font-size: 11px; color: #888; }
        .price-tag { font-weight: bold; color: #f1c40f; font-size: 14px; }

        .btn-withdraw { background: linear-gradient(45deg, #6a0572, #a34293); color: white; border: none; padding: 15px; width: 100%; border-radius: 15px; font-weight: bold; cursor: pointer; margin-top: 10px; box-shadow: 0 5px 15px rgba(106, 5, 114, 0.3); }
        .btn-connect { background: #4ecca3; color: #1a1a2e; border: none; padding: 10px 20px; border-radius: 10px; font-weight: bold; cursor: pointer; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-stats">
        <span id="status">üîå –ù–µ–º–∞—î –∑–≤'—è–∑–∫—É</span>
        <span><b id="shagBalance">0.00</b> –®–ê–ì</span>
    </div>

    <button id="connectBtn" class="btn-connect" onclick="connect()">–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ –ì–∞–º–∞–Ω–µ—Ü—å</button>

    <div class="score-container">
        <h2 id="score">0</h2>
        <p>–í–ò–î–û–ë–£–¢–ò–ô –ö–ê–ú–Ü–ù–¨</p>
    </div>

    <div class="mine-area" id="mineArea">
        <img src="https://cdn-icons-png.flaticon.com/512/2531/2531114.png" id="rock" onclick="clickRock(event)">
    </div>

    <div style="display: flex; justify-content: space-between; padding: 0 20px; font-size: 14px; color: #4ecca3; margin-bottom: 15px;">
        <span>–ö–ª—ñ–∫: +<b id="pwr">1</b></span>
        <span>–ê–≤—Ç–æ: +<b id="auto">0</b>/—Å</span>
    </div>

    <div class="shop">
        <div class="upgrade-card" onclick="buy(1, 100)">
            <img src="https://cdn-icons-png.flaticon.com/512/2382/2382533.png" class="upgrade-icon">
            <div class="upgrade-info"><b>–ó–∞–ª—ñ–∑–Ω–∞ –ö–∏—Ä–∫–∞</b><span>–°–∏–ª–∞ –∫–ª—ñ–∫—É +5</span></div>
            <div class="price-tag">100 –®–ì</div>
        </div>

        <div class="upgrade-card" onclick="buy(2, 500)">
            <img src="https://cdn-icons-png.flaticon.com/512/616/616430.png" class="upgrade-icon">
            <div class="upgrade-info"><b>–ê–ª–º–∞–∑–Ω–∞ –ö–∏—Ä–∫–∞</b><span>–°–∏–ª–∞ –∫–ª—ñ–∫—É +25</span></div>
            <div class="price-tag">500 –®–ì</div>
        </div>

        <div class="upgrade-card" onclick="buy(3, 1000)">
            <img src="https://cdn-icons-png.flaticon.com/512/5024/5024467.png" class="upgrade-icon">
            <div class="upgrade-info"><b>–ë—Ä–∏–≥–∞–¥–∞</b><span>–ê–≤—Ç–æ-–≤–∏–¥–æ–±—É—Ç–æ–∫ +10/—Å</span></div>
            <div class="price-tag">1–∫ –®–ì</div>
        </div>
    </div>

    <button class="btn-withdraw" onclick="withdraw()">üéÅ –û–±–º—ñ–Ω—è—Ç–∏ –∫–∞–º—ñ–Ω—å –Ω–∞ –®–ê–ì</button>
</div>

<script>
    // --- –ö–û–ù–§–Ü–ì ---
    const tokenAddr = "0xd4c35feccf968f4a73be4717524c087d7d0ed229";
    const myWallet = "–í–ê–®–ê_–ê–î–†–ï–°–ê_–ì–ê–ú–ê–ù–¶–Ø"; // <-- –í–°–¢–ê–í–¢–ï –°–í–û–Æ
    const tgNick = "–í–ê–®_–ù–Ü–ö_–í_–¢–ì";          // <-- –í–°–¢–ê–í–¢–ï –°–í–Ü–ô –ù–Ü–ö –ë–ï–ó @

    const abi = ["function balanceOf(address o) view returns (uint256)","function decimals() view returns (uint8)","function transfer(address t, uint256 a) returns (bool)"];
    let score = 0, pwr = 1, auto = 0, provider, signer, contract, user;

    window.onload = () => {
        const s = localStorage.getItem('shag_v3');
        if(s) { const d = JSON.parse(atob(s)); score=d.s; pwr=d.p; auto=d.a; }
        update();
        setInterval(() => { if(auto>0){ score+=auto; update(); } }, 1000);
        setInterval(() => { save(); }, 5000);
    };

    function clickRock(e) {
        score += pwr;
        update();
        showPop(e.clientX, e.clientY, `+${pwr}`);
    }

    function showPop(x, y, txt) {
        const el = document.createElement('div');
        el.className = 'floating-number';
        el.innerText = txt;
        el.style.left = `${x - 20}px`;
        el.style.top = `${y - 40}px`;
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 700);
    }

    function update() {
        document.getElementById("score").innerText = Math.floor(score).toLocaleString();
        document.getElementById("pwr").innerText = pwr;
        document.getElementById("auto").innerText = auto;
    }

    function save() { localStorage.setItem('shag_v3', btoa(JSON.stringify({s:score, p:pwr, a:auto}))); }

    async function connect() {
        if(!window.ethereum) return alert("MetaMask –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ!");
        provider = new ethers.BrowserProvider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = await provider.getSigner();
        user = await signer.getAddress();
        contract = new ethers.Contract(tokenAddr, abi, signer);
        document.getElementById("status").innerText = "üü¢ " + user.slice(0,6);
        document.getElementById("connectBtn").style.display = "none";
        updBal();
    }

    async function updBal() {
        const b = await contract.balanceOf(user);
        const d = await contract.decimals();
        document.getElementById("shagBalance").innerText = parseFloat(ethers.formatUnits(b, d)).toFixed(2);
    }

    async function buy(t, pr) {
        if(!contract) return alert("–ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –≥–∞–º–∞–Ω–µ—Ü—å!");
        try {
            const d = await contract.decimals();
            const tx = await contract.transfer(myWallet, ethers.parseUnits(pr.toString(), d));
            alert("–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –º–µ—Ä–µ–∂—É...");
            await tx.wait();
            if(t===1) pwr+=5; if(t===2) pwr+=25; if(t===3) auto+=10;
            save(); update(); updBal();
            alert("‚úÖ –£—Å–ø—ñ—à–Ω–æ –∫—É–ø–ª–µ–Ω–æ!");
        } catch(e) { alert("–ü–æ–º–∏–ª–∫–∞ –æ–ø–ª–∞—Ç–∏ –∞–±–æ —Å–∫–∞—Å–æ–≤–∞–Ω–æ."); }
    }

    function withdraw() {
        if(!user) return alert("–°–ø–æ—á–∞—Ç–∫—É –ø—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è!");
        if(score < 1000) return alert("–ü–æ—Ç—Ä—ñ–±–Ω–æ –º—ñ–Ω—ñ–º—É–º 1000 –∫–∞–º–µ–Ω—é!");
        const s = Math.floor(score/100);
        if(!confirm(`–û–±–º—ñ–Ω—è—Ç–∏ ${Math.floor(score)} –∫–∞–º–µ–Ω—é –Ω–∞ ${s} –®–ê–ì?`)) return;
        const m = `–í–∏–≤—ñ–¥%20–®–ê–ì%0A–°—É–º–∞:%20${s}%0A–ì–∞–º–∞–Ω–µ—Ü—å:%20${user}`;
        score=0; save(); update();
        window.open(`https://t.me/${tgNick}?text=${m}`, '_blank');
    }
</script>
</body>
</html>
