<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–ê–ì –®–∞—Ö—Ç–∞—Ä - Web3 Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #0a0e1a; color: white; text-align: center; margin: 0; padding: 20px; user-select: none; }
        .container { max-width: 420px; margin: 0 auto; background: #131b2e; padding: 25px; border-radius: 30px; box-shadow: 0 25px 60px rgba(0,0,0,0.7); border: 1px solid #1f2d45; }
        
        /* –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ */
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); }
        .modal-content { background: #16213e; margin: 15% auto; padding: 25px; border-radius: 20px; width: 85%; max-width: 320px; border: 1px solid #4ecca3; }
        #copyText { background: #0a0e1a; padding: 12px; border-radius: 10px; font-size: 11px; text-align: left; margin: 15px 0; border: 1px solid #1f4a6d; color: #4ecca3; font-family: monospace; white-space: pre-wrap; line-height: 1.4; }

        .header-stats { display: flex; justify-content: space-between; align-items: center; font-size: 13px; background: #0f1626; padding: 12px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #1f4a6d; }
        .balance-box b { color: #f1c40f; }
        
        .score-container h2 { font-size: 45px; margin: 0; color: #f1c40f; text-shadow: 0 5px 15px rgba(241, 196, 15, 0.4); }
        
        /* –ó–ë–Ü–õ–¨–®–ï–ù–ê –ó–û–ù–ê –¢–ê –ú–ê–õ–Æ–ù–û–ö */
        .mine-area { position: relative; height: 300px; display: flex; justify-content: center; align-items: center; margin: 10px 0; }
        #rock { 
            width: 260px; /* –ó–±—ñ–ª—å—à–µ–Ω–∏–π —Ä–æ–∑–º—ñ—Ä */
            height: 260px; 
            cursor: pointer; 
            transition: transform 0.05s; 
            z-index: 5; 
            border-radius: 50%; 
            object-fit: cover; 
            box-shadow: 0 0 30px rgba(241, 196, 15, 0.3); 
            -webkit-tap-highlight-color: transparent; 
        }
        #rock:active { transform: scale(0.95); }

        .floating-number { position: absolute; color: #4ecca3; font-weight: bold; font-size: 30px; pointer-events: none; animation: floatUp 0.7s ease-out forwards; z-index: 10; }
        @keyframes floatUp { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-130px); } }

        .stats-row { display: flex; justify-content: space-around; font-size: 13px; color: #8892b0; margin-bottom: 20px; background: #0f1626; padding: 10px; border-radius: 12px; }
        .stats-row b { color: #4ecca3; }

        .shop { text-align: left; }
        .upgrade-card { background: #1a233a; border-radius: 15px; padding: 15px; margin-bottom: 12px; border: 1px solid #252f47; }
        .upgrade-icon { width: 45px; height: 45px; margin-right: 12px; border-radius: 50%; object-fit: cover; border: 1px solid #333; }
        
        .shop-actions { display: flex; flex-direction: column; gap: 6px; min-width: 90px; }
        .buy-btn { background: #4ecca3; color: #0a0e1a; border: none; padding: 8px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 12px; }
        .buy-btn.stone { background: #f1c40f; }
        
        .btn-withdraw { background: linear-gradient(45deg, #6a0572, #a34293); color: white; border: none; padding: 16px; width: 100%; border-radius: 15px; font-weight: bold; font-size: 15px; cursor: pointer; margin-top: 5px; }
        .btn-connect { background: #4ecca3; color: #0a0e1a; border: none; padding: 12px 24px; border-radius: 12px; font-weight: bold; cursor: pointer; margin-bottom: 20px; }
    </style>
</head>
<body>

<div id="withdrawModal" class="modal">
    <div class="modal-content">
        <h3 style="margin-top:0; color:#4ecca3">üìã –ó–∞—è–≤–∫–∞ —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–∞</h3>
        <div id="copyText"></div>
        <button class="buy-btn" style="width:100%; padding:16px; font-size:14px" onclick="copyAndGo()">–°–ö–û–ü–Ü–Æ–í–ê–¢–ò –¢–ê –í –¢–ï–õ–ï–ì–†–ê–ú</button>
        <button style="background:none; border:none; color:#8892b0; margin-top:15px; cursor:pointer;" onclick="closeModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    </div>
</div>

<div class="container">
    <div class="header-stats">
        <span id="status">üîå –ù–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ</span>
        <span class="balance-box">–ë–∞–ª–∞–Ω—Å: <b id="shagBalance">0.00</b> –®–ê–ì</span>
    </div>

    <button id="connectBtn" class="btn-connect" onclick="connect()">‚ö° –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ –ì–∞–º–∞–Ω–µ—Ü—å</button>

    <div class="score-container">
        <h2 id="score">0</h2>
        <p style="color:#4ecca3; font-size:10px; letter-spacing:2px; font-weight:bold; margin-top:5px">–í–ò–î–û–ë–£–¢–ò–ô –ö–ê–ú–Ü–ù–¨</p>
    </div>

    <div class="mine-area">
        <img src="assets/1shag/rock.png" id="rock" onclick="clickRock(event)" alt="–í–∏–¥–æ–±—É—Ç–æ–∫">
    </div>

    <div class="stats-row">
        <span>–ö–ª—ñ–∫: <b id="pwr">+1</b></span>
        <span>–ê–≤—Ç–æ: <b id="auto">0</b>/—Å</span>
    </div>

    <div class="shop">
        <div class="upgrade-card">
            <div style="display:flex; align-items:center; justify-content: space-between;">
                <div style="display:flex; align-items:center">
                    <img src="assets/1shag/pickaxe_iron.png" class="upgrade-icon">
                    <div style="text-align:left"><b style="font-size:14px">–ó–∞–ª—ñ–∑–Ω–∞ –ö–∏—Ä–∫–∞</b><br><span style="font-size:11px; color:#8892b0">+5 –¥–æ –∫–ª—ñ–∫—É</span></div>
                </div>
                <div class="shop-actions">
                    <button class="buy-btn" onclick="buy(1, 100)">100 –®–ì</button>
                    <button class="buy-btn stone" onclick="buyWithStone(1, 1000000)">1–ú –ö–ú</button>
                </div>
            </div>
        </div>
        
        <div class="upgrade-card">
            <div style="display:flex; align-items:center; justify-content: space-between;">
                <div style="display:flex; align-items:center">
                    <img src="assets/1shag/pickaxe_diamond.png" class="upgrade-icon">
                    <div style="text-align:left"><b style="font-size:14px">–ê–ª–º–∞–∑–Ω–∞ –ö–∏—Ä–∫–∞</b><br><span style="font-size:11px; color:#8892b0">+25 –¥–æ –∫–ª—ñ–∫—É</span></div>
                </div>
                <div class="shop-actions">
                    <button class="buy-btn" onclick="buy(2, 500)">500 –®–ì</button>
                    <button class="buy-btn stone" onclick="buyWithStone(2, 5000000)">5–ú –ö–ú</button>
                </div>
            </div>
        </div>

        <div class="upgrade-card">
            <div style="display:flex; align-items:center; justify-content: space-between;">
                <div style="display:flex; align-items:center">
                    <img src="assets/1shag/hedgehogs.png" class="upgrade-icon">
                    <div style="text-align:left"><b style="font-size:14px">–ë—Ä–∏–≥–∞–¥–∞ –á–∂–∞—á–∫—ñ–≤</b><br><span style="font-size:11px; color:#8892b0">+10/—Å –∞–≤—Ç–æ</span></div>
                </div>
                <div class="shop-actions">
                    <button class="buy-btn" onclick="buy(3, 1000)">1–∫ –®–ì</button>
                    <button class="buy-btn stone" onclick="buyWithStone(3, 10000000)">10–ú –ö–ú</button>
                </div>
            </div>
        </div>
    </div>

    <p style="color: #8892b0; font-size: 11px; margin-top: 20px; margin-bottom: 5px; font-weight: bold; text-transform: uppercase;">
        –ö—É—Ä—Å –æ–±–º—ñ–Ω—É: 10 000 –∫–∞–º—ñ–Ω—å = 1 –®–ê–ì
    </p>
    <button class="btn-withdraw" onclick="withdraw()">üéÅ –û–ë–ú–Ü–ù–Ø–¢–ò –ö–ê–ú–Ü–ù–¨ –ù–ê –®–ê–ì</button>
</div>

<script>
    const tokenAddr = "0xd4c35feccf968f4a73be4717524c087d7d0ed229";
    const myWallet = "0x988cE6555C015e0761579de477fC9f816203ea2E"; // –í–ê–®–ê –ê–î–†–ï–°–ê
    const tgNick = "coins_1SHAG"; // –í–ê–® –¢–ì –ù–Ü–ö

    const abi = ["function balanceOf(address o) view returns (uint256)","function decimals() view returns (uint8)","function transfer(address t, uint256 a) returns (bool)"];
    let score = 0, pwr = 1, auto = 0, user, contract, pendingMsg = "", oldScore = 0;

    window.onload = () => {
        const saved = localStorage.getItem('shag_v_ultra');
        if(saved) { 
            try {
                const d = JSON.parse(atob(saved)); 
                score = d.s || 0; pwr = d.p || 1; auto = d.a || 0; 
                updateMainImage();
            } catch(e) {}
        }
        updateUI();
        setInterval(() => { if(auto > 0){ score += auto; updateUI(); } }, 1000);
    };

    function updateMainImage() {
        const mainImg = document.getElementById("rock");
        if(auto > 0) mainImg.src = "assets/1shag/hedgehogs.png";
        else if(pwr > 25) mainImg.src = "assets/1shag/pickaxe_diamond.png";
        else if(pwr > 1) mainImg.src = "assets/1shag/pickaxe_iron.png";
        else mainImg.src = "assets/1shag/rock.png";
    }

    function clickRock(e) {
        score += pwr;
        updateUI();
        const num = document.createElement('div');
        num.className = 'floating-number';
        num.innerText = `+${pwr}`;
        num.style.left = `${e.clientX - 20}px`;
        num.style.top = `${e.clientY - 40}px`;
        document.body.appendChild(num);
        setTimeout(() => num.remove(), 700);
    }

    function updateUI() {
        document.getElementById("score").innerText = Math.floor(score).toLocaleString('uk-UA');
        document.getElementById("pwr").innerText = `+${pwr}`;
        document.getElementById("auto").innerText = auto;
        localStorage.setItem('shag_v_ultra', btoa(JSON.stringify({s:score, p:pwr, a:auto})));
    }

    async function connect() {
        if(!window.ethereum) return alert("–í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å MetaMask!");
        const p = new ethers.BrowserProvider(window.ethereum);
        const s = await p.getSigner();
        user = await s.getAddress();
        contract = new ethers.Contract(tokenAddr, abi, s);
        document.getElementById("status").innerText = "üü¢ " + user.slice(0,6);
        document.getElementById("connectBtn").style.display = "none";
        updBal();
    }

    async function updBal() {
        if(!contract) return;
        const b = await contract.balanceOf(user);
        const d = await contract.decimals();
        document.getElementById("shagBalance").innerText = parseFloat(ethers.formatUnits(b, d)).toFixed(2);
    }

    async function buy(t, pr) {
        if(!contract) return alert("–ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –≥–∞–º–∞–Ω–µ—Ü—å!");
        try {
            const d = await contract.decimals();
            const tx = await contract.transfer(myWallet, ethers.parseUnits(pr.toString(), d));
            await tx.wait();
            if(t === 1) pwr += 5; else if(t === 2) pwr += 25; else if(t === 3) auto += 10;
            updateMainImage(); updateUI(); updBal();
            alert("‚úÖ –£—Å–ø—ñ—à–Ω–æ –∫—É–ø–ª–µ–Ω–æ –∑–∞ –®–ê–ì!");
        } catch(e) { alert("–ü–æ–º–∏–ª–∫–∞ –æ–ø–ª–∞—Ç–∏"); }
    }

    function buyWithStone(t, price) {
        if (score < price) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–∞–º–µ–Ω—é! –¢—Ä–µ–±–∞ " + price.toLocaleString());
        if (confirm("–ö—É–ø–∏—Ç–∏ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –∑–∞ " + price.toLocaleString() + " –∫–∞–º–µ–Ω—é?")) {
            score -= price;
            if(t === 1) pwr += 5; else if(t === 2) pwr += 25; else if(t === 3) auto += 10;
            updateMainImage(); updateUI();
            alert("‚úÖ –£—Å–ø—ñ—à–Ω–æ –∫—É–ø–ª–µ–Ω–æ –∑–∞ –∫–∞–º—ñ–Ω—å!");
        }
    }

    function withdraw() {
        if(!user) return alert("–ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –≥–∞–º–∞–Ω–µ—Ü—å!");
        if(score < 100000) return alert("–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–æ 100 000 –∫–∞–º–µ–Ω—é!");
        
        oldScore = score;
        const amount = Math.floor(score / 10000); 
        const code = Math.floor(10000 + Math.random() * 89999);
        const now = new Date().toLocaleString('uk-UA');

        pendingMsg = `üëã –ó–ê–Ø–í–ö–ê –ù–ê –í–ò–í–Ü–î\nüìÖ –î–∞—Ç–∞: ${now}\nüí∞ –°—É–º–∞: ${amount} –®–ê–ì\n‚õèÔ∏è –ö–∞–º—ñ–Ω—å: ${Math.floor(score)}\nüíº –ì–∞–º–∞–Ω–µ—Ü—å: ${user}\nüîê –ö–æ–¥: ${code}`;
        
        document.getElementById("copyText").innerText = pendingMsg;
        document.getElementById("withdrawModal").style.display = "block";
        score = 0;
        updateUI();
    }

    function copyAndGo() {
        navigator.clipboard.writeText(pendingMsg).then(() => {
            oldScore = 0;
            localStorage.setItem('shag_v_ultra', btoa(JSON.stringify({s: 0, p: pwr, a: auto})));
            alert("–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!");
            window.open(`https://t.me/${tgNick}`, '_blank');
            document.getElementById("withdrawModal").style.display = "none";
        });
    }

    function closeModal() {
        if (oldScore > 0) { score = oldScore; oldScore = 0; }
        updateUI();
        document.getElementById("withdrawModal").style.display = "none";
    }
</script>
</body>
</html>
