<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>SHAG Breaker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg-main: #050814;
      --bg-card: #111727;
      --accent: #f1c40f;
      --accent2: #3498db;
      --text-main: #ffffff;
      --text-soft: #bfc6d8;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at 0% 0%, rgba(241, 196, 15, 0.14) 0, transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(52, 152, 219, 0.18) 0, transparent 55%),
        radial-gradient(circle at top, #242a3b 0, #0b0e16 45%, #020308 100%);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    .wrapper {
      width: 100%;
      max-width: 480px;
      background: rgba(3, 6, 20, 0.92);
      border-radius: 24px;
      padding: 18px 16px 14px;
      box-shadow: 0 24px 80px rgba(0, 0, 0, 0.7);
      border: 1px solid rgba(241, 196, 15, 0.14);
      backdrop-filter: blur(16px);
    }

    /* HEADER */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .title-block { display: flex; flex-direction: column; gap: 4px; }

    .title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.3rem;
      font-weight: 700;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .subtitle { font-size: 0.78rem; color: var(--text-soft); }

    .stats {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .stat-card {
      background: rgba(9, 12, 30, 0.95);
      border-radius: 12px;
      padding: 4px 8px;
      min-width: 68px;
      text-align: right;
      border: 1px solid rgba(255, 255, 255, 0.04);
    }

    .stat-label {
      font-size: 0.7rem;
      color: var(--text-soft);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .stat-value {
      font-size: 0.9rem;
      font-weight: 700;
      margin-top: 1px;
    }

    .stat-value span { font-size: 0.7rem; opacity: 0.8; }

    /* TOP CONTROLS */
    .top-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      margin-bottom: 10px;
      font-size: 0.72rem;
      color: var(--text-soft);
    }

    .hint { line-height: 1.3; flex: 1; }
    .hint strong { color: var(--accent); }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 7px 13px;
      font-size: 0.78rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      cursor: pointer;
      background: linear-gradient(135deg, var(--accent2), var(--accent));
      color: #020308;
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.5);
      transition: 0.1s;
      text-decoration: none;
      white-space: nowrap;
    }

    .btn:active {
      transform: translateY(1px) scale(0.97);
      opacity: 0.9;
    }

    /* GAME AREA */
    .game-shell {
      background: linear-gradient(145deg, #050815, #0c1024);
      border-radius: 18px;
      padding: 8px;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    canvas {
      display: block;
      width: 100%;
      height: auto;
      border-radius: 12px;
      background: radial-gradient(circle at top, #181c32 0, #050814 68%);
    }

    /* MOBILE BUTTONS */
    .bottom-controls {
      margin-top: 8px;
      text-align: center;
      font-size: 0.78rem;
      color: var(--text-soft);
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: center;
    }

    .buttons-row {
      display: flex;
      gap: 8px;
      max-width: 260px;
      width: 100%;
      justify-content: center;
    }

    .control-btn {
      flex: 1;
      border-radius: 14px;
      padding: 10px 0;
      border: none;
      background: rgba(12, 21, 46, 0.96);
      color: #fdfdfd;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.5);
      transition: 0.1s;
      user-select: none;
    }

    .control-btn:active {
      transform: translateY(1px) scale(0.97);
    }

    .kbd {
      border: 1px solid rgba(191, 198, 216, 0.5);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.7rem;
      background: rgba(8, 12, 30, 0.7);
    }
  </style>
</head>
<body>
  <div class="wrapper">

    <!-- HEADER -->
    <div class="header">
      <div class="title-block">
        <div class="title">
          <img src="images/logo.png" alt="SHAG" style="width:30px;height:30px;border-radius:50%;box-shadow:0 0 12px rgba(241,196,15,0.8);" />
          SHAG Breaker
        </div>
        <div class="subtitle">Відбивай монету SHAG, ламай блоки та збирай SHAG.</div>
      </div>

      <div class="stats">
        <div class="stat-card">
          <div class="stat-label">Рахунок</div>
          <div class="stat-value" id="score">0 <span>SHAG</span></div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Рекорд</div>
          <div class="stat-value" id="best">0 <span>SHAG</span></div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Рівень</div>
          <div class="stat-value" id="level">1</div>
        </div>
      </div>
    </div>

    <!-- TOP CONTROL PANEL -->
    <div class="top-controls">
      <div class="hint">
        <strong>Керування:</strong> стрілки / A, D / кнопки внизу.<br/>
        Пропусти монету — втрачаєш життя.
      </div>

      <a href="shag-games.html" class="btn">← До ігор</a>
      <button class="btn" id="toggleBtn">Старт</button>
    </div>

    <!-- GAME CANVAS -->
    <div class="game-shell">
      <canvas id="gameCanvas" width="360" height="520"></canvas>
    </div>

    <!-- BOTTOM MOBILE BUTTONS -->
    <div class="bottom-controls">
      <div>Екранні кнопки для мобільних:</div>
      <div class="buttons-row">
        <button class="control-btn" id="btnLeft">◀ Вліво</button>
        <button class="control-btn" id="btnRight">Вправо ▶</button>
      </div>
      <div>
        На ПК працюють
        <span class="kbd">←</span><span class="kbd">→</span>,
        <span class="kbd">A</span><span class="kbd">D</span>,
        <span class="kbd">Пробіл</span> — старт/пауза.
      </div>
    </div>

  </div>

  <script>
    /* ==== CANVAS SETUP ==== */
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const toggleBtn = document.getElementById("toggleBtn");

    const W = canvas.width;
    const H = canvas.height;

    /* ==== GAME OBJECTS ==== */
    const paddleHeight = 14;
    let paddleWidth = 80;
    let paddleX = (W - paddleWidth) / 2;
    const paddleSpeed = 6;

    // Enlarged ball
    const ballRadius = 15;
    let ballX, ballY, dx, dy;

    // Bricks
    let brickRowCount = 5;
    let brickColumnCount = 7;
    const brickWidth = 36;
    const brickHeight = 16;
    const brickPadding = 18;
    const brickOffsetTop = 60;
    const brickOffsetLeft = 0;
    let bricks = [];

    // Stats
    let score = 0;
    let bestScore = 0;
    let level = 1;
    let lives = 3;

    // State
    let rightPressed = false;
    let leftPressed = false;
    let isRunning = false;
    let hasStarted = false;

    const floatTexts = [];

    /* ==== INITIALIZATION ==== */
    function initBricks() {
      bricks = [];
      for (let c = 0; c < brickColumnCount; c++) {
        bricks[c] = [];
        for (let r = 0; r < brickRowCount; r++) {
          bricks[c][r] = { x: 0, y: 0, status: 1, value: 10 };
        }
      }
    }

    function resetBallAndPaddle() {
      ballX = W / 2;
      ballY = H - 80;
      const speed = 3 + level * 0.3;
      dx = speed * (Math.random() > 0.5 ? 1 : -1);
      dy = -speed;
      paddleX = (W - paddleWidth) / 2;
    }

    function loadBestScore() {
      const stored = localStorage.getItem("shag_breaker_best");
      const v = parseInt(stored);
      bestScore = Number.isFinite(v) ? v : 0;
      updateStatsUI();
    }

    function saveBestScore() {
      if (score > bestScore) {
        bestScore = score;
        localStorage.setItem("shag_breaker_best", bestScore.toString());
      }
    }

    function updateStatsUI() {
      document.getElementById("score").innerHTML =
        score + " <span>SHAG</span>";
      document.getElementById("best").innerHTML =
        bestScore + " <span>SHAG</span>";
      document.getElementById("level").textContent = level;
    }

    /* ==== ANIM FLOAT TEXT ==== */
    function addFloatText(text, x, y) {
      floatTexts.push({ text, x, y, alpha: 1, dy: -0.5 });
    }

    function drawFloatTexts() {
      ctx.save();
      ctx.font = "12px system-ui";
      ctx.textAlign = "center";
      floatTexts.forEach((t, i) => {
        ctx.globalAlpha = t.alpha;
        ctx.fillStyle = "#f1c40f";
        ctx.fillText(t.text, t.x, t.y);
        t.y += t.dy;
        t.alpha -= 0.015;
      });
      ctx.restore();
      for (let i = floatTexts.length - 1; i >= 0; i--) {
        if (floatTexts[i].alpha <= 0) floatTexts.splice(i, 1);
      }
    }

    /* ==== DRAW FUNCTIONS ==== */
    function drawBackground() {
      const g = ctx.createLinearGradient(0, 0, 0, H);
      g.addColorStop(0, "#18203a");
      g.addColorStop(1, "#050814");
      ctx.fillStyle = g;
      ctx.fillRect(0, 0, W, H);
    }

    function drawPaddle() {
      const g = ctx.createLinearGradient(paddleX, 0, paddleX, H);
      g.addColorStop(0, "#3498db");
      g.addColorStop(1, "#9b59b6");

      const y = H - 32;
      ctx.fillStyle = g;
      ctx.fillRect(paddleX, y, paddleWidth, paddleHeight);
    }

    /* ==== BALL WITH REAL LOGO ==== */
    const logoImg = new Image();
    logoImg.src = "images/logo.png";

    function drawBall() {
      // golden background circle
      const g = ctx.createRadialGradient(
        ballX - 3, ballY - 3, 2,
        ballX, ballY, ballRadius + 3
      );
      g.addColorStop(0, "#fff8d6");
      g.addColorStop(0.4, "#f1c40f");
      g.addColorStop(1, "#b67c00");

      ctx.beginPath();
      ctx.fillStyle = g;
      ctx.arc(ballX, ballY, ballRadius, 0, Math.PI * 2);
      ctx.fill();
      ctx.closePath();

      // draw real logo inside circle
      if (logoImg.complete) {
        ctx.save();
        ctx.beginPath();
        ctx.arc(ballX, ballY, ballRadius - 3, 0, Math.PI * 2);
        ctx.clip();
        ctx.drawImage(
          logoImg,
          ballX - (ballRadius - 3),
          ballY - (ballRadius - 3),
          (ballRadius - 3) * 2,
          (ballRadius - 3) * 2
        );
        ctx.restore();
      }
    }

    function drawBricks() {
      for (let c = 0; c < brickColumnCount; c++) {
        for (let r = 0; r < brickRowCount; r++) {
          const b = bricks[c][r];
          if (!b.status) continue;

          const x = c * (brickWidth + brickPadding) + brickOffsetLeft;
          const y = r * (brickHeight + brickPadding) + brickOffsetTop;

          b.x = x;
          b.y = y;

          const g = ctx.createLinearGradient(x, y, x, y + brickHeight);
          if (r === 0) { g.addColorStop(0, "#f1c40f"); g.addColorStop(1, "#e67e22"); }
          else if (r === 1 || r === 2) { g.addColorStop(0, "#3498db"); g.addColorStop(1, "#2980b9"); }
          else { g.addColorStop(0, "#9b59b6"); g.addColorStop(1, "#8e44ad"); }

          ctx.fillStyle = g;
          ctx.fillRect(x, y, brickWidth, brickHeight);
        }
      }
    }

    function drawHUD() {
      ctx.save();
      ctx.font = "12px system-ui";
      ctx.fillStyle = "rgba(200,200,220,0.9)";
      ctx.fillText("Життя: " + lives, 10, 10);
      ctx.textAlign = "right";
      ctx.fillText("Рівень: " + level, W - 10, 10);
      ctx.restore();
    }

    /* ==== COLLISIONS ==== */
    function collisionDetection() {
      for (let c = 0; c < brickColumnCount; c++) {
        for (let r = 0; r < brickRowCount; r++) {
          const b = bricks[c][r];
          if (!b.status) continue;

          if (
            ballX > b.x &&
            ballX < b.x + brickWidth &&
            ballY > b.y &&
            ballY < b.y + brickHeight
          ) {
            dy = -dy;
            b.status = 0;
            score += b.value;
            addFloatText("+" + b.value + " SHAG", ballX, ballY);
            saveBestScore();
            updateStatsUI();
            checkWin();
          }
        }
      }
    }

    function checkWin() {
      for (let c = 0; c < brickColumnCount; c++) {
        for (let r = 0; r < brickRowCount; r++) {
          if (bricks[c][r].status) return;
        }
      }

      level++;
      lives = Math.min(5, lives + 1);
      brickRowCount = Math.min(8, brickRowCount + 1);

      initBricks();
      resetBallAndPaddle();
      updateStatsUI();
    }

    /* ==== GAME LOOP ==== */
    function draw() {
      drawBackground();
      drawBricks();
      drawPaddle();
      drawBall();
      drawHUD();
      drawFloatTexts();
    }

    function update() {
      if (rightPressed && paddleX < W - paddleWidth - 4) paddleX += paddleSpeed;
      else if (leftPressed && paddleX > 4) paddleX -= paddleSpeed;

      ballX += dx;
      ballY += dy;

      if (ballX + ballRadius > W || ballX - ballRadius < 0) dx = -dx;
      if (ballY - ballRadius < 18) dy = -dy;

      const py = H - 32;
      if (
        ballY + ballRadius >= py &&
        ballY + ballRadius <= py + paddleHeight + 4 &&
        ballX > paddleX &&
        ballX < paddleX + paddleWidth
      ) {
        const hit = (ballX - (paddleX + paddleWidth / 2)) / (paddleWidth / 2);
        const speed = Math.sqrt(dx * dx + dy * dy);
        const angle = hit * (Math.PI / 3);
        dx = speed * Math.sin(angle);
        dy = -Math.abs(speed * Math.cos(angle));
      }

      if (ballY - ballRadius > H) {
        lives--;
        const finalScore = score;

        if (lives <= 0) {
          isRunning = false;
          toggleBtn.textContent = "Старт";

          setTimeout(() => {
            alert("Гра закінчена! Ваш результат: " + finalScore + " SHAG");
          }, 120);

          level = 1;
          lives = 3;
          score = 0;
          brickRowCount = 5;
          initBricks();
          resetBallAndPaddle();
          saveBestScore();
          updateStatsUI();
          hasStarted = false;
        } else {
          resetBallAndPaddle();
        }
      }

      collisionDetection();
    }

    function loop() {
      draw();
      if (isRunning) update();
      requestAnimationFrame(loop);
    }

    /* ==== CONTROLS ==== */
    function toggleGame() {
      if (!hasStarted) {
        isRunning = true;
        hasStarted = true;
        toggleBtn.textContent = "Пауза";
      } else {
        isRunning = !isRunning;
        toggleBtn.textContent = isRunning ? "Пауза" : "Продовжити";
      }
    }

    document.addEventListener("keydown", (e) => {
      const k = e.key.toLowerCase();
      if (k === "arrowright" || k === "d") rightPressed = true;
      if (k === "arrowleft" || k === "a") leftPressed = true;
      if (k === " ") { e.preventDefault(); toggleGame(); }
    });

    document.addEventListener("keyup", (e) => {
      const k = e.key.toLowerCase();
      if (k === "arrowright" || k === "d") rightPressed = false;
      if (k === "arrowleft" || k === "a") leftPressed = false;
    });

    toggleBtn.addEventListener("click", toggleGame);

    /* ==== MOBILE BUTTONS ==== */
    function hold(btnId, dir) {
      const btn = document.getElementById(btnId);
      const press = () => dir === "l" ? leftPressed = true : rightPressed = true;
      const release = () => dir === "l" ? leftPressed = false : rightPressed = false;

      btn.addEventListener("mousedown", press);
      btn.addEventListener("mouseup", release);
      btn.addEventListener("mouseleave", release);

      btn.addEventListener("touchstart", (e) => { e.preventDefault(); press(); }, { passive: false });
      btn.addEventListener("touchend", (e) => { e.preventDefault(); release(); }, { passive: false });
      btn.addEventListener("touchcancel", release);
    }

    hold("btnLeft", "l");
    hold("btnRight", "r");

    /* ==== START ==== */
    function init() {
      loadBestScore();
      initBricks();
      resetBallAndPaddle();
      updateStatsUI();
      draw();
      loop();
    }

    init();
  </script>
</body>
</html>
